{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Shop Thể Thao - DBP Sports{% endblock %}

{% block extra_css %}
<style>
:root {
  --primary: #dc2626;
  --primary-dark: #b91c1c;
  --secondary: #6b7280;
  --success: #16a34a;
  --danger: #dc2626;
  --warning: #f59e0b;
  --info: #0ea5e9;
  --light: #f8fafc;
  --dark: #1f2937;
  --gold: #fbbf24;
  --gradient-primary: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  --gradient-hero: linear-gradient(135deg, #f59e0b 0%, #dc2626 50%, #b91c1c 100%);
  --gradient-sunset: linear-gradient(135deg, #fbbf24 0%, #f59e0b 25%, #dc2626 75%, #991b1b 100%);
  --shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  --shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
  --border-radius: 0.5rem;
  --border-radius-lg: 1rem;
}

/* ========================================
   BANNER SECTION - REDESIGNED FROM SCRATCH
   ======================================== */

.hero-section {
  background: var(--gradient-sunset);
  color: white;
  padding: 0;
  position: relative;
  overflow: hidden;
  min-height: 80vh;
  display: flex;
  align-items: center;
  width: 100vw;
  margin-left: calc(-50vw + 50%);
}

/* Banner Container */
.banner-container {
  position: relative;
  width: 100vw;
  height: 80vh;
  background-size: cover !important;
  background-position: center center !important;
  background-repeat: no-repeat !important;
}

.banner-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2));
  z-index: 1;
}

.banner-content {
  position: relative;
  z-index: 10;
  height: 80vh;
  display: flex;
  align-items: center;
}

/* Banner Content Layout */
.banner-row {
  height: 100%;
  align-items: center;
  position: relative;
  z-index: 10;
}

.banner-text-col {
  padding: 2rem;
  min-width: 0;
  flex: 1;
}

.banner-visual-col {
  padding: 2rem;
  position: relative;
}

/* Text Elements */
.banner-content-wrapper {
  position: relative;
  z-index: 10;
  color: white;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
  max-width: 100%;
  width: 100%;
}

.banner-badge {
  display: inline-block;
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.2);
  padding: 0.5rem 1.5rem;
  border-radius: 25px;
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 2rem;
  backdrop-filter: blur(15px);
  color: white;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  line-height: 1.3;
  white-space: nowrap;
}

.banner-title {
  font-size: 4rem;
  font-weight: 900;
  margin-bottom: 1rem;
  text-shadow: 0 4px 8px rgba(0,0,0,0.5);
  background: linear-gradient(45deg, #ffffff, #fbbf24);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.3;
  max-width: 100%;
  white-space: normal;
  word-spacing: 0.2em;
  hyphens: none;
}

.banner-subtitle {
  font-size: 1.5rem;
  margin-bottom: 2rem;
  opacity: 0.95;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  font-weight: 300;
  line-height: 1.6;
  max-width: 100%;
  white-space: normal;
}

.banner-btn {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.2);
  color: white;
  padding: 1.2rem 2.5rem;
  border-radius: 50px;
  text-decoration: none;
  font-weight: 700;
  font-size: 1.1rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(15px);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  white-space: nowrap;
}

.banner-btn:hover {
  background: rgba(255,255,255,0.25);
  color: white;
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  border-color: rgba(255,255,255,0.3);
}

/* Visual Area */
.banner-visual-area {
  position: relative;
  height: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Categories Section */
.categories-section {
  padding: 4rem 0;
  background: var(--light);
}

.category-card {
  background: white;
  border-radius: var(--border-radius-lg);
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
  border: 1px solid rgba(0,0,0,0.05);
  height: 100%;
}

.category-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.category-icon {
  width: 80px;
  height: 80px;
  background: var(--gradient-primary);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1rem;
  font-size: 2rem;
  color: white;
}

.category-name {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--dark);
}

.category-count {
  color: var(--secondary);
  font-size: 0.9rem;
}

/* Products Section */
.products-section {
  padding: 4rem 0;
}

.section-title {
  font-size: 2.5rem;
  font-weight: 700;
  text-align: center;
  margin-bottom: 3rem;
  color: var(--dark);
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 4px;
  background: var(--gradient-primary);
  border-radius: 2px;
}

.product-card {
  background: white;
  border-radius: var(--border-radius-lg);
  overflow: hidden;
  transition: all 0.3s ease;
  border: 1px solid rgba(0,0,0,0.05);
  height: 100%;
  position: relative;
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.product-image {
  position: relative;
  overflow: hidden;
  height: 250px;
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-card:hover .product-image img {
  transform: scale(1.05);
}

.product-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background: var(--danger);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

.product-badge.featured {
  background: var(--success);
}

.product-badge.bestseller {
  background: var(--warning);
  color: var(--dark);
}

.product-badge.new {
  background: var(--info);
  color: white;
}

.product-badge.sport {
  background: var(--primary);
  color: white;
}

.product-info {
  padding: 1.5rem;
}

.product-name {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--dark);
  line-height: 1.4;
}

.product-description {
  color: var(--secondary);
  font-size: 0.9rem;
  margin-bottom: 1rem;
  line-height: 1.5;
}

.product-price {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.current-price {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--success);
}

.original-price {
  font-size: 1rem;
  color: var(--secondary);
  text-decoration: line-through;
}

.product-actions {
  display: flex;
  gap: 0.5rem;
  align-items: stretch;
  margin-top: auto; /* Đẩy nút xuống dưới cùng */
  padding-top: 1rem;
}

.product-card {
  display: flex;
  flex-direction: column;
  height: 100%; /* Đảm bảo tất cả card có cùng chiều cao */
}

.product-info {
  display: flex;
  flex-direction: column;
  flex: 1; /* Chiếm hết không gian còn lại */
}

.btn-add-cart {
  flex: 1;
  background: var(--primary);
  color: white;
  border: none;
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  min-height: 44px; /* Chiều cao đồng nhất */
  text-decoration: none;
  min-width: 0;
}

.btn-add-cart:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  color: white;
}

.add-to-cart-btn {
  flex: 1;
  background: var(--primary);
  color: white;
  border: none;
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  min-height: 45px;
}

.add-to-cart-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

/* Đảm bảo view-details-btn không bị ảnh hưởng bởi CSS của add-to-cart-btn */
.product-actions .view-details-btn {
  flex: 1;
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  transition: all 0.3s ease;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  min-height: 44px; /* Chiều cao đồng nhất */
  min-width: 0;
  white-space: nowrap;
  overflow: visible;
}

.product-actions .view-details-btn i {
  display: inline-block;
  margin-right: 0.5rem;
}

.product-actions .view-details-btn:hover {
  background: var(--primary);
  color: white;
  text-decoration: none;
}

.btn-view {
  flex: 1;
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  transition: all 0.3s ease;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  min-height: 44px; /* Chiều cao đồng nhất */
  min-width: 0;
}

.btn-view:hover {
  background: var(--primary);
  color: white;
}

/* Đảm bảo view-details-btn không bị ảnh hưởng bởi CSS của add-to-cart-btn */
.product-actions .view-details-btn {
  flex: 1;
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
  padding: 0.75rem 1rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  transition: all 0.3s ease;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  min-height: 44px; /* Chiều cao đồng nhất */
  min-width: 0;
  white-space: nowrap;
  overflow: visible;
}

.product-actions .view-details-btn i {
  display: inline-block;
  margin-right: 0.5rem;
}

.product-actions .view-details-btn:hover {
  background: var(--primary);
  color: white;
  text-decoration: none;
}

/* Đảm bảo nút hiển thị rõ trên background sáng */
.products-section[style*="background: var(--light)"] .view-details-btn {
  background: white !important;
  color: var(--primary) !important;
  border: 2px solid var(--primary) !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  white-space: nowrap !important;
  overflow: visible !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-size: 0.9rem !important;
  min-height: 44px !important; /* Chiều cao đồng nhất */
  min-width: 0 !important;
  padding: 0.75rem 1rem !important;
  font-weight: 600 !important;
}

.products-section[style*="background: var(--light)"] .view-details-btn i {
  display: inline-block !important;
  margin-right: 0.5rem !important;
  color: var(--primary) !important;
}

.products-section[style*="background: var(--light)"] .view-details-btn:hover {
  background: var(--primary) !important;
  color: white !important;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.products-section[style*="background: var(--light)"] .view-details-btn:hover i {
  color: white !important;
}

/* CSS với specificity cao nhất để đảm bảo nút hiển thị */
section.products-section[style*="background: var(--light)"] div.product-actions a.view-details-btn {
  background: white !important;
  color: var(--primary) !important;
  border: 2px solid var(--primary) !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
  white-space: nowrap !important;
  overflow: visible !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-size: 0.9rem !important;
  min-height: 44px !important; /* Chiều cao đồng nhất */
  min-width: 0 !important;
  padding: 0.75rem 1rem !important;
  font-weight: 600 !important;
  text-decoration: none !important;
  flex: 1 !important;
}

section.products-section[style*="background: var(--light)"] div.product-actions a.view-details-btn i {
  display: inline-block !important;
  margin-right: 0.5rem !important;
  color: var(--primary) !important;
}

section.products-section[style*="background: var(--light)"] div.product-actions a.view-details-btn:hover {
  background: var(--primary) !important;
  color: white !important;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
  text-decoration: none !important;
}

section.products-section[style*="background: var(--light)"] div.product-actions a.view-details-btn:hover i {
  color: white !important;
}

/* Stats Section */
.stats-section {
  background: var(--gradient-secondary);
  color: white;
  padding: 3rem 0;
}

.stat-item {
  text-align: center;
}

.stat-number {
  font-size: 3rem;
  font-weight: 800;
  margin-bottom: 0.5rem;
}

.stat-label {
  font-size: 1.1rem;
  opacity: 0.9;
}

/* ========================================
   RESPONSIVE DESIGN - REDESIGNED
   ======================================== */

@media (max-width: 768px) {
  /* Banner Section Mobile */
  .hero-section {
    min-height: calc(100vh - 80px);
    padding: 0;
    margin-left: calc(-50vw + 50%);
    width: 100vw;
  }
  
  .banner-container {
    height: calc(100vh - 80px);
  }
  
  .banner-content {
    height: calc(100vh - 80px);
    padding: 0 1rem;
  }
  
  .banner-text-col {
    padding: 1rem;
    text-align: center;
    min-width: 0;
    flex: 1;
  }
  
  .banner-visual-col {
    padding: 1rem;
  }
  
  .banner-content-wrapper {
    text-align: center;
    max-width: 100%;
    width: 100%;
  }
  
  .banner-badge {
    font-size: 0.75rem;
    padding: 0.4rem 1rem;
    letter-spacing: 0.3px;
    margin-bottom: 1.5rem;
    white-space: nowrap;
    display: inline-block;
  }
  
  .banner-title {
    font-size: 2.2rem;
    margin-top: 1.5rem;
    line-height: 1.3;
    white-space: normal;
    word-spacing: 0.2em;
    hyphens: none;
  }
  
  .banner-subtitle {
    font-size: 1rem;
    margin-bottom: 2.5rem;
    text-align: center;
  }
  
  .banner-btn {
    margin: 0 auto;
    padding: 1rem 2rem;
    font-size: 1rem;
    min-height: 55px;
    letter-spacing: 0.3px;
    white-space: nowrap;
    display: inline-flex;
  }
  
  .banner-visual-area {
    height: 300px;
    margin-top: 2rem;
  }
  
  /* Carousel Controls Mobile */
  .carousel-control-prev,
  .carousel-control-next {
    width: 40px !important;
    height: 40px !important;
    background-color: rgba(0,0,0,0.5) !important;
    z-index: 15 !important;
  }
  
  .carousel-control-prev {
    left: 10px !important;
  }
  
  .carousel-control-next {
    right: 10px !important;
  }
  
  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    width: 16px !important;
    height: 16px !important;
  }
  
  /* Floating Icons Mobile */
  .banner-floating-icon {
    font-size: 2rem !important;
  }
  
  .banner-floating-icon i {
    font-size: 2rem !important;
  }
  
  .banner-floating-icon.football {
    top: 20%;
    left: 10%;
  }
  
  .banner-floating-icon.trophy {
    top: 30%;
    right: 10%;
  }
  
  .banner-floating-icon.medal {
    bottom: 25%;
    right: 15%;
  }
  
  /* Other sections */
  .section-title {
    font-size: 2rem;
  }
  
  .product-image {
    height: 200px;
  }
  
  .stat-number {
    font-size: 2rem;
  }
}

/* Floating Icons - Redesigned */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-20px); }
}

.banner-floating-elements {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 5;
}

.banner-floating-icon {
  position: absolute;
  pointer-events: none;
}

.banner-floating-icon.football {
  top: 15%;
  left: 20%;
  z-index: 5;
  animation: float 3s ease-in-out infinite;
}

.banner-floating-icon.trophy {
  top: 25%;
  right: 15%;
  z-index: 6;
  animation: float 3s ease-in-out infinite 1.2s;
}

.banner-floating-icon.medal {
  bottom: 20%;
  right: 25%;
  z-index: 7;
  animation: float 3s ease-in-out infinite 2.1s;
}

/* Shop Menu Section */
.shop-menu-section {
  padding: 1rem 0;
  background: white;
  border-bottom: 1px solid var(--light);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.shop-menu-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem; /* Giảm khoảng cách */
  flex-wrap: nowrap;
}

.shop-search-filter {
  flex: 0 0 auto;
  order: 1;
}

.search-form {
  width: 200px; /* Thu gọn lại */
  position: relative;
}

.search-container {
  position: relative;
  width: 100%;
  display: flex;
  align-items: center;
}

.search-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  background: white;
  border: 1px solid #d1d5db;
  border-radius: 8px; /* Bo góc nhẹ */
  overflow: visible; /* Cho phép nút đè ra ngoài */
  transition: all 0.3s ease;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  flex: 1;
  padding-right: 20px; /* Giảm padding vì nút đè ít hơn */
}

.search-input-wrapper:focus-within {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

.search-input {
  flex: 1;
  border: none;
  padding: 0.5rem 0.75rem; /* Thu gọn padding */
  font-size: 0.85rem; /* Thu gọn font size */
  background: transparent;
  outline: none;
  color: var(--dark);
}

.search-input::placeholder {
  color: #9ca3af;
  font-style: italic;
}

.search-btn {
  position: absolute;
  right: -15px; /* Đè lên thanh input chỉ 1/3 */
  top: 50%;
  transform: translateY(-50%);
  background: var(--primary);
  border: none;
  padding: 0.5rem;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 40px;
  height: 40px;
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  z-index: 10;
}

.search-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-50%) scale(1.05);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.search-icon {
  width: 14px; /* Thu gọn icon */
  height: 14px;
  color: white;
  display: block;
  transition: all 0.3s ease;
}

.search-btn:hover .search-icon {
  transform: scale(1.1);
  color: white;
}

.search-suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #e5e7eb;
  border-top: none;
  border-radius: 0 0 8px 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  z-index: 1000;
  max-height: 200px;
  overflow-y: auto;
  display: none;
  margin-top: 4px;
}

.search-suggestion-item {
  padding: 0.75rem 1rem;
  cursor: pointer;
  border-bottom: 1px solid #f3f4f6;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.search-suggestion-item:hover {
  background: var(--light);
  color: var(--primary);
}

.search-suggestion-item:last-child {
  border-bottom: none;
}

.search-suggestion-item.suggestion-active {
  background: var(--primary);
  color: white;
}

.search-suggestion-item.suggestion-active i {
  color: white;
}

.suggestion-icon {
  width: 14px;
  height: 14px;
  color: var(--primary);
  flex-shrink: 0;
}

.search-suggestion-item.suggestion-active .suggestion-icon {
  color: white;
}

.shop-menu {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem; /* Giảm khoảng cách giữa các menu items */
  flex-wrap: nowrap;
  flex: 1;
  order: 2;
}

.shop-menu-item {
  flex: 0 0 auto;
}

.shop-menu-link {
  display: flex;
  align-items: center;
  gap: 0.3rem; /* Giảm khoảng cách giữa icon và text */
  padding: 0.4rem 0.6rem; /* Giảm padding */
  color: var(--dark);
  text-decoration: none;
  font-weight: 600;
  border-radius: var(--border-radius);
  transition: all 0.3s ease;
  white-space: nowrap;
  font-size: 0.85rem; /* Giảm font size */
}

/* Style cho menu item chỉ có icon */
.shop-menu-link.icon-only {
  padding: 0.5rem; /* Padding đồng đều cho icon */
  justify-content: center;
  min-width: 40px;
}

.shop-menu-link:hover {
  background: var(--light);
  color: var(--primary);
  text-decoration: none;
}

.shop-menu-separator {
  width: 2px; /* Tăng độ dày từ 1px lên 2px */
  height: 20px; /* Tăng chiều cao từ 16px lên 20px */
  background: #dc2626; /* Đổi màu đỏ để nổi bật hơn */
  opacity: 1; /* Tăng opacity lên 1 để hiển thị rõ nhất */
  margin: 0 0.5rem; /* Thêm margin để tạo khoảng cách */
  border-radius: 1px; /* Thêm bo góc nhẹ */
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .shop-menu-wrapper {
    flex-direction: column;
    gap: 1rem;
  }
  
  .shop-search-filter {
    order: 2;
  }
  
  .shop-menu {
    order: 1;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.3rem;
  }
  
  .search-form {
    width: 100%;
    max-width: 250px;
  }
  
  .search-input-wrapper {
    border-radius: 6px;
  }
  
  .search-input {
    padding: 0.4rem 0.6rem;
    font-size: 0.8rem;
  }
  
  .search-btn {
    width: 35px;
    height: 35px;
    right: -12px; /* Điều chỉnh cho mobile */
  }
  
  .search-icon {
    width: 12px;
    height: 12px;
  }
  
  .search-input-wrapper {
    padding-right: 15px; /* Giảm padding cho mobile */
  }
  
  .shop-menu-link {
    font-size: 0.8rem;
    padding: 0.3rem 0.5rem;
  }
}



.shop-menu-item {
  position: relative;
}

.shop-menu-link {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  color: var(--dark);
  text-decoration: none;
  font-weight: 600;
  font-size: 0.95rem;
  border-radius: var(--border-radius);
  transition: all 0.3s ease;
  position: relative;
}

.shop-menu-link:hover {
  color: var(--primary);
  background: rgba(220, 38, 38, 0.1);
  transform: translateY(-2px);
}

.shop-menu-link i:first-child {
  font-size: 1.1rem;
}

.shop-menu-link .fa-chevron-down {
  font-size: 0.8rem;
  transition: transform 0.3s ease;
}

.shop-menu-item.dropdown .shop-menu-link[aria-expanded="true"] .fa-chevron-down {
  transform: rotate(180deg);
}

.shop-menu-item .dropdown-menu {
  border: none;
  box-shadow: var(--shadow-lg);
  border-radius: var(--border-radius);
  padding: 0.5rem 0;
  margin-top: 0.5rem;
}

/* Cart styles removed - using main navigation cart popup instead */

/* Shop menu separator removed - no longer needed */

.shop-menu-item .dropdown-item {
  padding: 0.75rem 1.5rem;
  color: var(--dark);
  font-weight: 500;
  transition: all 0.3s ease;
}

.shop-menu-item .dropdown-item:hover {
  background: var(--primary);
  color: white;
  transform: translateX(5px);
}

.shop-menu-item .dropdown-item i {
  color: var(--primary);
  transition: color 0.3s ease;
}

.shop-menu-item .dropdown-item:hover i {
  color: white;
}

/* Responsive */
@media (max-width: 768px) {
  .shop-menu-wrapper {
    flex-direction: column;
    gap: 1rem;
  }
  
  .search-form {
    width: 100%;
    max-width: 300px;
  }
  
  .shop-menu {
    gap: 1rem;
    justify-content: flex-start;
    overflow-x: auto;
    padding: 0 1rem;
  }
  
  .shop-menu-link {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    white-space: nowrap;
  }

  /* Hero Section Mobile */
  .hero-title {
    font-size: 2.5rem !important;
    line-height: 1.2;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }
  
  .hero-subtitle {
    font-size: 1.2rem !important;
    line-height: 1.4;
    text-align: center !important;
  }
  
  .hero-badge {
    font-size: 0.8rem !important;
    padding: 0.4rem 1rem !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important;
    margin: 0 auto !important;
    display: inline-block !important;
  }
  
  .hero-btn {
    font-size: 1rem !important;
    padding: 1rem 2rem !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important;
    margin: 0 auto !important;
    display: inline-flex !important;
  }
  
  .hero-visual-area {
    height: 300px !important;
    margin-top: 2rem;
  }
  
  .floating-icon {
    display: block !important; /* Show floating icons on mobile */
  }
  
  .floating-elements {
    height: 300px !important;
  }
  
  .floating-icon {
    font-size: 2rem !important;
  }
  
  .floating-icon i {
    font-size: 2rem !important;
  }
  
  .min-vh-85 {
    min-height: auto;
    padding: 2rem 0;
  }
}

/* Filtered Products Section */
.filtered-products-section {
  padding: 4rem 0;
  background: var(--light);
}

.filtered-products-section .section-title {
  font-size: 2.5rem;
  font-weight: 900;
  text-align: center;
  margin-bottom: 3rem;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.product-badge.sale {
  background: var(--danger);
  color: white;
}


/* Loading Animation */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Carousel Custom Styles */
.carousel-indicators {
  bottom: 20px;
}

.carousel-indicators button {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: rgba(255,255,255,0.5);
  border: none;
  margin: 0 5px;
}

.carousel-indicators button.active {
  background-color: var(--primary);
}

.carousel-control-prev,
.carousel-control-next {
  width: 50px;
  height: 50px;
  background-color: rgba(0,0,0,0.3);
  border-radius: 50%;
  top: 50%;
  transform: translateY(-50%);
  z-index: 15 !important;
  cursor: pointer;
}

.carousel-control-prev {
  left: 20px;
}

.carousel-control-next {
  right: 20px;
}

.carousel-control-prev-icon,
.carousel-control-next-icon {
  width: 20px;
  height: 20px;
}

.carousel-control-prev:hover,
.carousel-control-next:hover {
  background-color: rgba(0,0,0,0.5);
  transform: translateY(-50%) scale(1.1);
}

/* Carousel Base Styles */
#bannerCarousel {
  margin: 0;
  padding: 0;
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
}
</style>
{% endblock %}

{% block content %}
<!-- Shop Menu Section -->
<section class="shop-menu-section">
  <div class="container">
    <div class="shop-menu-wrapper">
      <!-- Search Filter -->
      <div class="shop-search-filter">
        <form method="GET" action="{% url 'shop:home' %}" class="search-form" id="searchForm">
          <div class="search-container">
            <div class="search-input-wrapper">
              <input type="text" name="search" class="search-input" placeholder="Tìm kiếm sản phẩm..." value="{{ request.GET.search }}" id="searchInput">
            </div>
            <button type="submit" class="search-btn" id="searchBtn">
              <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="sr-only">Tìm kiếm</span>
            </button>
            <div class="search-suggestions" id="searchSuggestions"></div>
          </div>
        </form>
      </div>
      
      <!-- Shop Menu -->
      <div class="shop-menu">
      <div class="shop-menu-item dropdown">
        <a href="#" class="shop-menu-link dropdown-toggle" id="shopMenDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fas fa-male"></i>
          <span>Đồ Nam</span>
          <i class="fas fa-chevron-down ms-1"></i>
        </a>
        <ul class="dropdown-menu" aria-labelledby="shopMenDropdown">
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?category=men&type=shoes">
            <i class="fas fa-shoe-prints me-2"></i>Giày
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?category=men&type=clothing">
            <i class="fas fa-tshirt me-2"></i>Quần áo
          </a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=football-shoes">
            <i class="fas fa-futbol me-2"></i>Giày đá bóng
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=badminton-shoes">
            <i class="fas fa-shuttle-van me-2"></i>Giày cầu lông
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=pickleball-shoes">
            <i class="fas fa-table-tennis me-2"></i>Giày Pickleball
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=running-shoes">
            <i class="fas fa-running me-2"></i>Giày chạy bộ
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=basketball-shoes">
            <i class="fas fa-basketball-ball me-2"></i>Giày bóng rổ
          </a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=polo-shirts">
            <i class="fas fa-user-tie me-2"></i>Áo polo
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=t-shirts">
            <i class="fas fa-tshirt me-2"></i>Áo T-shirt
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=jackets">
            <i class="fas fa-wind me-2"></i>Áo khoác
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=pants">
            <i class="fas fa-user me-2"></i>Quần
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=pickleball-apparel">
            <i class="fas fa-table-tennis me-2"></i>Quần áo pickleball
          </a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?category=men">
            <i class="fas fa-list me-2"></i>Tất cả đồ nam
          </a></li>
        </ul>
      </div>
      <div class="shop-menu-item dropdown">
        <a href="#" class="shop-menu-link dropdown-toggle" id="shopWomenDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fas fa-female"></i>
          <span>Đồ Nữ</span>
          <i class="fas fa-chevron-down ms-1"></i>
        </a>
        <ul class="dropdown-menu" aria-labelledby="shopWomenDropdown">
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?category=women&type=shoes">
            <i class="fas fa-shoe-prints me-2"></i>Giày
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?category=women&type=clothing">
            <i class="fas fa-tshirt me-2"></i>Quần áo
          </a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=football-shoes">
            <i class="fas fa-futbol me-2"></i>Giày đá bóng
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=badminton-shoes">
            <i class="fas fa-shuttle-van me-2"></i>Giày cầu lông
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=pickleball-shoes">
            <i class="fas fa-table-tennis me-2"></i>Giày Pickleball
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=running-shoes">
            <i class="fas fa-running me-2"></i>Giày chạy bộ
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=basketball-shoes">
            <i class="fas fa-basketball-ball me-2"></i>Giày bóng rổ
          </a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=polo-shirts">
            <i class="fas fa-user-tie me-2"></i>Áo polo
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=t-shirts">
            <i class="fas fa-tshirt me-2"></i>Áo T-shirt
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=jackets">
            <i class="fas fa-wind me-2"></i>Áo khoác
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=pants">
            <i class="fas fa-user me-2"></i>Quần
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:product_list' %}?category=pickleball-apparel">
            <i class="fas fa-table-tennis me-2"></i>Quần áo pickleball
          </a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?category=women">
            <i class="fas fa-list me-2"></i>Tất cả đồ nữ
          </a></li>
        </ul>
      </div>
      <div class="shop-menu-item dropdown">
        <a href="#" class="shop-menu-link dropdown-toggle" id="shopSportsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fas fa-futbol"></i>
          <span>Môn Thể Thao</span>
          <i class="fas fa-chevron-down ms-1"></i>
        </a>
        <ul class="dropdown-menu" aria-labelledby="shopSportsDropdown">
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?sport=football">
            <i class="fas fa-futbol me-2"></i>Bóng đá
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?sport=pickleball">
            <i class="fas fa-table-tennis me-2"></i>Pickleball
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?sport=basketball">
            <i class="fas fa-basketball-ball me-2"></i>Bóng rổ
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?sport=badminton">
            <i class="fas fa-shuttle-van me-2"></i>Cầu lông
          </a></li>
          <li><a class="dropdown-item" href="{% url 'shop:home' %}?sport=running">
            <i class="fas fa-running me-2"></i>Chạy bộ
          </a></li>
        </ul>
      </div>
      <div class="shop-menu-item">
        <a href="{% url 'shop:home' %}?sale=true" class="shop-menu-link">
          <i class="fas fa-tags"></i>
          <span>Sale</span>
        </a>
      </div>
      <div class="shop-menu-item">
        <a href="{% url 'blog:home' %}" class="shop-menu-link">
          <i class="fas fa-blog"></i>
          <span>Blog</span>
        </a>
      </div>
      
      <!-- Cart removed - using main navigation cart icon instead -->
    </div>
  </div>
</section>

<!-- ========================================
     BANNER SECTION - REDESIGNED FROM SCRATCH
     ======================================== -->
{% if banners %}
<section class="hero-section">
  <div id="bannerCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
    <div class="carousel-indicators">
      {% for banner in banners %}
      <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="{{ forloop.counter0 }}" 
              {% if forloop.first %}class="active" aria-current="true"{% endif %} 
              aria-label="Slide {{ forloop.counter }}"></button>
      {% endfor %}
    </div>
    
    <div class="carousel-inner">
      {% for banner in banners %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="banner-container" style="background-image: url('{% if banner.main_image %}{{ banner.main_image.url }}{% else %}{% static 'images/no-image.png' %}{% endif %}');">
          <div class="banner-overlay"></div>
          <div class="container banner-content">
            <div class="row banner-row">
              <div class="col-lg-6 banner-text-col">
                <div class="banner-content-wrapper">
                  <div class="banner-badge">
                    <i class="fas fa-star me-2"></i>
                    {% if banner.badge_text %}{{ banner.badge_text }}{% else %}SẢN PHẨM NỔI BẬT{% endif %}
                  </div>
                  <h1 class="banner-title">{% if banner.title %}{{ banner.title }}{% else %}Sản Phẩm Thể Thao{% endif %}</h1>
                  <p class="banner-subtitle">{% if banner.subtitle %}{{ banner.subtitle }}{% else %}Chất lượng cao, giá cả hợp lý{% endif %}</p>
                  <a href="{% if banner.product %}{% url 'shop:product_detail' banner.product.slug %}{% elif banner.button_url %}{{ banner.button_url }}{% else %}{% url 'shop:product_list' %}{% endif %}" class="banner-btn">
                    <i class="fas fa-shopping-bag me-2"></i>
                    {% if banner.button_text %}{{ banner.button_text }}{% else %}MUA NGAY{% endif %}
                  </a>
                </div>
              </div>
              <div class="col-lg-6 banner-visual-col">
                <div class="banner-visual-area">
                  <div class="banner-floating-elements">
                    <div class="banner-floating-icon football">
                      <i class="fas fa-futbol" style="font-size: 3.5rem; color: rgba(255,255,255,0.6);"></i>
                    </div>
                    <div class="banner-floating-icon trophy">
                      <i class="fas fa-trophy" style="font-size: 3.2rem; color: var(--gold);"></i>
                    </div>
                    <div class="banner-floating-icon medal">
                      <i class="fas fa-medal" style="font-size: 2.8rem; color: rgba(255,255,255,0.7);"></i>
                    </div>
                  </div>
                  {% if banner.product and banner.product.main_image %}
                    <img src="{{ banner.product.main_image.url }}" alt="{{ banner.product.name }}" class="img-fluid" style="max-height: 300px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    
    <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</section>
{% else %}
<!-- Default Hero Section - Redesigned -->
<section class="hero-section">
  <div class="banner-container" style="background: var(--gradient-sunset);">
    <div class="banner-overlay"></div>
    <div class="container banner-content">
      <div class="row banner-row">
        <div class="col-lg-6 banner-text-col">
          <div class="banner-content-wrapper">
            <div class="banner-badge">
              <i class="fas fa-star me-2"></i>
              THƯƠNG HIỆU THỂ THAO CHÍNH HÃNG
            </div>
            <h1 class="banner-title">DBP SPORTS</h1>
            <p class="banner-subtitle">
              Trang phục thi đấu đội tuyển bóng đá Việt Nam 2025
              VINH QUANG VIỆT NAM
            </p>
            <div class="d-flex gap-3">
                <a href="{% url 'shop:product_list' %}" class="banner-btn">
                    <i class="fas fa-shopping-bag me-2"></i>
                    Xem ngay
                </a>
                {% if main_cart_count > 0 %}
                <a href="{% url 'shop:cart' %}" class="banner-btn main-cart-count-btn">
                    <i class="fas fa-shopping-cart me-2"></i>
                    Giỏ Hàng ({{ main_cart_count }})
                </a>
                {% endif %}
            </div>
          </div>
        </div>
        <div class="col-lg-6 banner-visual-col">
          <div class="banner-visual-area">
            <div class="banner-floating-elements">
              <div class="banner-floating-icon football">
                <i class="fas fa-futbol" style="font-size: 3.5rem; color: rgba(255,255,255,0.6);"></i>
              </div>
              <div class="banner-floating-icon trophy">
                <i class="fas fa-trophy" style="font-size: 3.2rem; color: var(--gold);"></i>
              </div>
              <div class="banner-floating-icon medal">
                <i class="fas fa-medal" style="font-size: 2.8rem; color: rgba(255,255,255,0.7);"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %}

<!-- Filtered Products Section -->
{% if filtered_products %}
<section class="filtered-products-section" id="search-results">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h2 class="section-title">
          {% if current_search %}
            Kết quả tìm kiếm: "{{ current_search }}"
          {% elif current_category == 'men' and current_type == 'shoes' %}
            Giày Nam
          {% elif current_category == 'men' and current_type == 'clothing' %}
            Quần Áo Nam
          {% elif current_category == 'women' and current_type == 'shoes' %}
            Giày Nữ
          {% elif current_category == 'women' and current_type == 'clothing' %}
            Quần Áo Nữ
          {% elif current_sport == 'football' %}
            Sản Phẩm Bóng Đá
          {% elif current_sport == 'pickleball' %}
            Sản Phẩm Pickleball
          {% elif current_sale == 'true' %}
            Sản Phẩm Sale
          {% else %}
            Sản Phẩm Được Lọc
          {% endif %}
        </h2>
        {% if current_search %}
          <p class="text-muted">Tìm thấy {{ filtered_products|length }} sản phẩm</p>
        {% endif %}
      </div>
    </div>
    <div class="row">
      {% for product in filtered_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            {% if product.is_on_sale %}
              <div class="product-badge sale">Sale</div>
            {% elif product.is_featured %}
              <div class="product-badge featured">Nổi bật</div>
            {% elif product.is_bestseller %}
              <div class="product-badge bestseller">Bán chạy</div>
            {% endif %}
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="view-details-btn">
                <i class="bi bi-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}



<!-- New Products Section -->
<section class="products-section">
  <div class="container">
    <h2 class="section-title">Sản Phẩm Mới</h2>
    <div class="row">
      {% for product in new_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            <div class="product-badge new">Mới</div>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="view-details-btn">
                <i class="bi bi-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">Chưa có sản phẩm mới nào.</p>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'shop:product_list' %}?sort=newest" class="btn btn-outline-primary">
        Xem tất cả sản phẩm mới
      </a>
    </div>
  </div>
</section>

<!-- Bestseller Products Section -->
{% if bestseller_products %}
<section class="products-section" style="background: var(--light);">
  <div class="container">
    <h2 class="section-title">Sản Phẩm Bán Chạy</h2>
    <div class="row">
      {% for product in bestseller_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            <div class="product-badge bestseller">Bán chạy</div>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="view-details-btn">
                <i class="bi bi-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'shop:product_list' %}?sort=bestseller" class="btn btn-primary btn-lg">
        Xem tất cả sản phẩm bán chạy
      </a>
    </div>
  </div>
</section>
{% endif %}

<!-- Football Products Section -->
<section class="products-section">
  <div class="container">
    <h2 class="section-title">Bóng Đá</h2>
    <div class="row">
      {% for product in football_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            <div class="product-badge sport">Bóng đá</div>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="view-details-btn">
                <i class="bi bi-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">Chưa có sản phẩm bóng đá nào.</p>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'shop:product_list' %}?sport=football" class="btn btn-outline-primary">
        Xem tất cả sản phẩm bóng đá
      </a>
    </div>
  </div>
</section>

<!-- Pickleball Products Section -->
<section class="products-section" style="background: var(--light);">
  <div class="container">
    <h2 class="section-title">Pickleball</h2>
    <div class="row">
      {% for product in pickleball_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            <div class="product-badge sport">Pickleball</div>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="view-details-btn">
                <i class="bi bi-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">Chưa có sản phẩm pickleball nào.</p>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'shop:product_list' %}?sport=pickleball" class="btn btn-outline-primary">
        Xem tất cả sản phẩm pickleball
      </a>
    </div>
  </div>
</section>

<!-- Featured Products -->
{% if featured_products %}
<section class="products-section">
  <div class="container">
    <h2 class="section-title">Mặt Hàng Tiêu Biểu</h2>
    <div class="row">
      {% for product in featured_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            <div class="product-badge featured">Nổi bật</div>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="btn-add-cart" onclick="addToCart({{ product.id }})">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="btn-view">
                <i class="fas fa-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'shop:product_list' %}?sort=bestseller" class="btn btn-primary btn-lg">
        Xem tất cả sản phẩm nổi bật
      </a>
    </div>
  </div>
</section>
{% endif %}


<!-- Latest Products -->
{% if latest_products %}
<section class="products-section">
  <div class="container">
    <h2 class="section-title">Sản Phẩm Mới Nhất</h2>
    <div class="row">
      {% for product in latest_products %}
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="product-card">
          <div class="product-image">
            {% if product.main_image %}
              <img src="{{ product.main_image.url }}" alt="{{ product.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="{{ product.name }}" loading="lazy">
            {% endif %}
            <div class="product-badge" style="background: var(--info);">Mới</div>
          </div>
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-description">{{ product.short_description|truncatewords:15 }}</p>
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="current-price">{{ product.sale_price|vnd_format }}</span>
                <span class="original-price">{{ product.price|vnd_format }}</span>
              {% else %}
                <span class="current-price">{{ product.price|vnd_format }}</span>
              {% endif %}
            </div>
            <div class="product-actions">
              <button class="btn-add-cart" onclick="addToCart({{ product.id }})">
                <i class="fas fa-shopping-cart me-2"></i>
                Thêm vào giỏ
              </button>
              <a href="{% url 'shop:product_detail' product.slug %}" class="btn-view">
                <i class="fas fa-eye me-2"></i>
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-4">
      <a href="{% url 'shop:product_list' %}" class="btn btn-primary btn-lg">
        Xem tất cả sản phẩm mới
      </a>
    </div>
  </div>
</section>
{% endif %}






<!-- Stats Section -->
<section class="stats-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <div class="stat-number">1000+</div>
          <div class="stat-label">Sản phẩm chất lượng</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <div class="stat-number">5000+</div>
          <div class="stat-label">Khách hàng hài lòng</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <div class="stat-number">24/7</div>
          <div class="stat-label">Hỗ trợ khách hàng</div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <div class="stat-number">100%</div>
          <div class="stat-label">Chính hãng</div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Global variables for popup
let currentProduct = null;
let selectedSize = null;
let currentQuantity = 1;

function addToCart(productId) {
  // Kiểm tra đăng nhập trước
  if (!document.body.dataset.userAuthenticated || document.body.dataset.userAuthenticated === 'False') {
    showNotification('Vui lòng đăng nhập để thêm sản phẩm vào giỏ hàng', 'error');
    setTimeout(() => {
      window.location.href = '{% url "account_login" %}';
    }, 1500);
    return;
  }
  
  // Hiển thị popup chọn size và số lượng
  showAddToCartPopup(productId);
}

function showAddToCartPopup(productId) {
  // Reset state
  currentProduct = null;
  selectedSize = null;
  currentQuantity = 1;
  
  // Kiểm tra Bootstrap có sẵn không
  if (typeof bootstrap === 'undefined') {
    console.error('Bootstrap is not loaded');
    showNotification('Có lỗi xảy ra khi hiển thị popup', 'error');
    return;
  }
  
  // Hiển thị modal
  const modalElement = document.getElementById('addToCartModal');
  if (modalElement) {
    try {
      const modal = new bootstrap.Modal(modalElement, {
        backdrop: true,
        keyboard: true,
        focus: true
      });
      modal.show();
      
      // Load product info
      loadProductInfo(productId);
    } catch (error) {
      console.error('Error creating modal:', error);
      showNotification('Có lỗi xảy ra khi hiển thị popup', 'error');
    }
  } else {
    console.error('Modal element not found');
    showNotification('Có lỗi xảy ra khi hiển thị popup', 'error');
  }
}

function loadProductInfo(productId) {
  fetch(`{% url "shop:product_info_api" product_id=0 %}`.replace('0', productId), {
    method: 'GET',
    headers: {
      'X-CSRFToken': '{{ csrf_token }}',
      'Cache-Control': 'no-cache',
      'Pragma': 'no-cache'
    },
    cache: 'no-cache'
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      currentProduct = data.product;
      displayProductInfo(data.product);
      setupQuantityControls();
    } else {
      showNotification(data.message, 'error');
      const modalElement = document.getElementById('addToCartModal');
      if (modalElement) {
        const modalInstance = bootstrap.Modal.getInstance(modalElement);
        if (modalInstance) {
          modalInstance.hide();
        }
      }
    }
  })
  .catch(error => {
    console.error('Error loading product info:', error);
    showNotification('Có lỗi xảy ra khi tải thông tin sản phẩm', 'error');
    const modalElement = document.getElementById('addToCartModal');
    if (modalElement) {
      const modalInstance = bootstrap.Modal.getInstance(modalElement);
      if (modalInstance) {
        modalInstance.hide();
      }
    }
  });
}

function displayProductInfo(product) {
  const productInfo = document.getElementById('product-info');
  const sizeSelection = document.getElementById('size-selection');
  const sizeOptions = document.getElementById('size-options');
  
  // Display product info
  productInfo.innerHTML = `
    <img src="${product.image || '/static/images/no-image.png'}" alt="${product.name}" class="product-image-popup">
    <div class="product-details-popup">
      <h6 class="product-name-popup">${product.name}</h6>
      <div class="product-price-popup">
        ${product.is_on_sale ? 
          `${product.sale_price.toLocaleString()}đ <span class="original-price">${product.original_price.toLocaleString()}đ</span>` :
          `${product.price.toLocaleString()}đ`
        }
      </div>
    </div>
  `;
  
  // Display size options if product has sizes
  if (product.has_sizes && product.sizes && product.sizes.length > 0) {
    sizeSelection.style.display = 'block';
    sizeOptions.innerHTML = '';
    
    product.sizes.forEach(size => {
      const sizeOption = document.createElement('div');
      sizeOption.className = `size-option ${size.stock === 0 ? 'out-of-stock' : ''}`;
      sizeOption.textContent = size.name;
      sizeOption.dataset.sizeId = size.id;
      sizeOption.dataset.stock = size.stock;
      
      if (size.stock > 0) {
        sizeOption.addEventListener('click', function() {
          selectSize(this);
        });
      }
      
      sizeOptions.appendChild(sizeOption);
    });
  } else {
    sizeSelection.style.display = 'none';
  }
  
  // Update stock info
  updateStockInfo();
}

function selectSize(sizeElement) {
  // Remove previous selection
  document.querySelectorAll('.size-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // Add selection to clicked option
  sizeElement.classList.add('selected');
  selectedSize = {
    id: sizeElement.dataset.sizeId,
    name: sizeElement.textContent,
    stock: parseInt(sizeElement.dataset.stock)
  };
  
  // Update quantity max and stock info
  updateStockInfo();
}

function setupQuantityControls() {
  // Reset quantity
  currentQuantity = 1;
  
  // Use event delegation for better reliability
  document.addEventListener('click', function(e) {
    if (e.target && e.target.id === 'decrease-qty') {
      e.preventDefault();
      if (currentQuantity > 1) {
        currentQuantity--;
        const quantityInput = document.getElementById('quantity-input');
        if (quantityInput) {
          quantityInput.value = currentQuantity;
          updateStockInfo();
        }
      }
    }
    
    if (e.target && e.target.id === 'increase-qty') {
      e.preventDefault();
      const maxStock = selectedSize ? selectedSize.stock : (currentProduct ? currentProduct.stock_quantity : 10);
      if (currentQuantity < maxStock) {
        currentQuantity++;
        const quantityInput = document.getElementById('quantity-input');
        if (quantityInput) {
          quantityInput.value = currentQuantity;
          updateStockInfo();
        }
      }
    }
  });
  
  // Handle quantity input change
  document.addEventListener('change', function(e) {
    if (e.target && e.target.id === 'quantity-input') {
      const value = parseInt(e.target.value);
      const maxStock = selectedSize ? selectedSize.stock : (currentProduct ? currentProduct.stock_quantity : 10);
      
      if (value < 1) {
        currentQuantity = 1;
        e.target.value = 1;
      } else if (value > maxStock) {
        currentQuantity = maxStock;
        e.target.value = maxStock;
      } else {
        currentQuantity = value;
      }
      
      updateStockInfo();
    }
  });
  
  // Set initial value
  const quantityInput = document.getElementById('quantity-input');
  if (quantityInput) {
    quantityInput.value = currentQuantity;
  }
}

function updateStockInfo() {
  const stockInfo = document.getElementById('stock-info');
  const quantityInput = document.getElementById('quantity-input');
  const increaseBtn = document.getElementById('increase-qty');
  
  const maxStock = selectedSize ? selectedSize.stock : currentProduct.stock_quantity;
  
  // Update quantity input max
  quantityInput.max = maxStock;
  
  // Update stock info text
  if (maxStock === 0) {
    stockInfo.textContent = 'Hết hàng';
    stockInfo.className = 'stock-info out-of-stock';
    increaseBtn.disabled = true;
  } else if (maxStock <= 5) {
    stockInfo.textContent = `Chỉ còn ${maxStock} sản phẩm`;
    stockInfo.className = 'stock-info low-stock';
    increaseBtn.disabled = currentQuantity >= maxStock;
  } else {
    stockInfo.textContent = `Còn ${maxStock} sản phẩm`;
    stockInfo.className = 'stock-info';
    increaseBtn.disabled = currentQuantity >= maxStock;
  }
  
  // Update decrease button
  document.getElementById('decrease-qty').disabled = currentQuantity <= 1;
}

function confirmAddToCart() {
  if (!currentProduct) {
    showNotification('Có lỗi xảy ra', 'error');
    return;
  }
  
  // Validate size selection if required
  if (currentProduct.has_sizes && currentProduct.sizes.length > 0 && !selectedSize) {
    showNotification('Vui lòng chọn size', 'error');
    return;
  }
  
  // Validate stock
  const maxStock = selectedSize ? selectedSize.stock : currentProduct.stock_quantity;
  if (currentQuantity > maxStock) {
    showNotification('Số lượng vượt quá tồn kho', 'error');
    return;
  }
  
  // Disable button and show loading
  const confirmBtn = document.getElementById('confirm-add-to-cart');
  const originalText = confirmBtn.innerHTML;
  confirmBtn.innerHTML = '<span class="loading"></span>';
  confirmBtn.disabled = true;
  
  // Add to cart
  fetch('{% url "shop:add_to_cart" %}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': '{{ csrf_token }}',
      'Cache-Control': 'no-cache',
      'Pragma': 'no-cache'
    },
    body: JSON.stringify({
      product_id: currentProduct.id,
      quantity: currentQuantity,
      size_id: selectedSize ? selectedSize.id : null,
      timestamp: Date.now()
    }),
    cache: 'no-cache'
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Close modal
      const modalElement = document.getElementById('addToCartModal');
      if (modalElement) {
        const modalInstance = bootstrap.Modal.getInstance(modalElement);
        if (modalInstance) {
          modalInstance.hide();
        } else {
          // Fallback: hide modal manually
          modalElement.classList.remove('show');
          document.body.classList.remove('modal-open');
          const backdrop = document.querySelector('.modal-backdrop');
          if (backdrop) {
            backdrop.remove();
          }
        }
      }
      
      // Show success notification
      showNotification(data.message, 'success');
      
      // Update cart count everywhere
      updateMainCartCount(data.cart_count);
      
      // Load cart popup content if it's open
      if (document.getElementById('cartPopup') && document.getElementById('cartPopup').classList.contains('show')) {
        loadCartContent();
      }
    } else {
      showNotification(data.message, 'error');
    }
  })
  .catch(error => {
    console.error('Error adding to cart:', error);
    showNotification('Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng', 'error');
  })
  .finally(() => {
    // Restore button
    confirmBtn.innerHTML = originalText;
    confirmBtn.disabled = false;
  });
}

function showNotification(message, type) {
  // Tạo thông báo
  const notification = document.createElement('div');
  notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
  notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
  notification.innerHTML = `
    ${message}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  `;
  
  document.body.appendChild(notification);
  
  // Tự động ẩn sau 3 giây
  setTimeout(() => {
    if (notification.parentNode) {
      notification.remove();
    }
  }, 3000);
}

// Load cart count when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Kiểm tra localStorage trước
  const storedCartCount = localStorage.getItem('main_cart_count');
  if (storedCartCount) {
    const cartCountElement = document.getElementById('cart-count');
    if (cartCountElement) {
      cartCountElement.textContent = storedCartCount;
    }
  }
  
  loadCartCount();
  
  // Xử lý nút add-to-cart-btn với data-product-id
  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', function() {
      const productId = this.getAttribute('data-product-id');
      if (productId) {
        addToCart(productId);
      }
    });
  });
  
  // Xử lý nút confirm-add-to-cart trong popup (sử dụng event delegation)
  document.addEventListener('click', function(e) {
    if (e.target && e.target.id === 'confirm-add-to-cart') {
      confirmAddToCart();
    }
  });
  
  // Xử lý thanh tìm kiếm với gợi ý
  initSearchSuggestions();
});

function initSearchSuggestions() {
  const searchInput = document.getElementById('searchInput');
  const searchSuggestions = document.getElementById('searchSuggestions');
  const searchForm = document.getElementById('searchForm');
  
  if (!searchInput || !searchSuggestions) return;
  
  let searchTimeout;
  
  // Xử lý khi người dùng nhập
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    
    clearTimeout(searchTimeout);
    
    if (query.length < 2) {
      hideSuggestions();
      return;
    }
    
    searchTimeout = setTimeout(() => {
      fetchSuggestions(query);
    }, 300);
  });
  
  // Xử lý khi focus vào input
  searchInput.addEventListener('focus', function() {
    const query = this.value.trim();
    if (query.length >= 2) {
      fetchSuggestions(query);
    }
  });
  
  // Ẩn gợi ý khi click ra ngoài
  document.addEventListener('click', function(e) {
    if (!searchForm.contains(e.target)) {
      hideSuggestions();
    }
  });
  
  // Xử lý khi nhấn phím
  searchInput.addEventListener('keydown', function(e) {
    const suggestions = searchSuggestions.querySelectorAll('.search-suggestion-item');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const active = searchSuggestions.querySelector('.suggestion-active');
      if (active) {
        active.classList.remove('suggestion-active');
        const next = active.nextElementSibling;
        if (next) {
          next.classList.add('suggestion-active');
        }
      } else if (suggestions.length > 0) {
        suggestions[0].classList.add('suggestion-active');
      }
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      const active = searchSuggestions.querySelector('.suggestion-active');
      if (active) {
        active.classList.remove('suggestion-active');
        const prev = active.previousElementSibling;
        if (prev) {
          prev.classList.add('suggestion-active');
        }
      }
    } else if (e.key === 'Enter') {
      e.preventDefault();
      const active = searchSuggestions.querySelector('.suggestion-active');
      if (active) {
        active.click();
      } else {
        searchForm.submit();
      }
    } else if (e.key === 'Escape') {
      hideSuggestions();
    }
  });
}

function fetchSuggestions(query) {
  const searchSuggestions = document.getElementById('searchSuggestions');
  
  // Gửi request để lấy gợi ý
  fetch(`{% url 'shop:home' %}?search=${encodeURIComponent(query)}&suggestions=true`, {
    method: 'GET',
    headers: {
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success && data.suggestions.length > 0) {
      showSuggestions(data.suggestions);
    } else {
      hideSuggestions();
    }
  })
  .catch(error => {
    console.log('Error fetching suggestions:', error);
    hideSuggestions();
  });
}

function showSuggestions(suggestions) {
  const searchSuggestions = document.getElementById('searchSuggestions');
  
  searchSuggestions.innerHTML = '';
  
  suggestions.forEach(suggestion => {
    const item = document.createElement('div');
    item.className = 'search-suggestion-item';
    item.innerHTML = `
      <svg class="suggestion-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>${suggestion.name}</span>
    `;
    
    item.addEventListener('click', function() {
      document.getElementById('searchInput').value = suggestion.name;
      hideSuggestions();
      document.getElementById('searchForm').submit();
    });
    
    searchSuggestions.appendChild(item);
  });
  
  searchSuggestions.style.display = 'block';
}

function hideSuggestions() {
  const searchSuggestions = document.getElementById('searchSuggestions');
  searchSuggestions.style.display = 'none';
  searchSuggestions.innerHTML = '';
}

function loadCartCount() {
  // Chỉ load cart count nếu chưa có từ context processor
  const currentCartCount = document.getElementById('cart-count');
  if (currentCartCount && currentCartCount.textContent !== '0' && currentCartCount.textContent !== '') {
    // Cart count đã có từ context processor, không cần load lại
    return;
  }
  
  fetch('{% url "shop:cart" %}', {
    method: 'GET',
    headers: {
      'X-Requested-With': 'XMLHttpRequest'
    }
  })
  .then(response => response.text())
  .then(html => {
    // Parse the cart count from the response
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const cartItems = doc.querySelectorAll('.cart-item');
    const cartCount = cartItems.length;
    
    // Update cart count display
    const cartCountElement = document.getElementById('cart-count');
    if (cartCountElement) {
      cartCountElement.textContent = cartCount;
    }
  })
  .catch(error => {
    console.log('Could not load cart count:', error);
  });
}

// Tự động cuộn xuống kết quả tìm kiếm khi có search query
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const hasSearch = urlParams.get('search') || urlParams.get('category') || urlParams.get('type') || urlParams.get('sport') || urlParams.get('sale');
  
  if (hasSearch) {
    const searchResults = document.getElementById('search-results');
    if (searchResults) {
      // Đợi một chút để trang load xong rồi mới scroll
      setTimeout(function() {
        searchResults.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }, 300);
    }
  }
  
  // Khởi tạo carousel với touch support
  const bannerCarousel = document.getElementById('bannerCarousel');
  if (bannerCarousel) {
    // Đảm bảo carousel hoạt động với Bootstrap 5
    const carousel = new bootstrap.Carousel(bannerCarousel, {
      interval: 5000,
      wrap: true,
      touch: true,
      keyboard: true
    });
    
    // Thêm touch/swipe support cho mobile
    let startX = 0;
    let endX = 0;
    
    bannerCarousel.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
    });
    
    bannerCarousel.addEventListener('touchend', function(e) {
      endX = e.changedTouches[0].clientX;
      const diffX = startX - endX;
      
      // Swipe left (next)
      if (diffX > 50) {
        carousel.next();
      }
      // Swipe right (prev)
      else if (diffX < -50) {
        carousel.prev();
      }
    });
  }
});
</script>

<!-- Contact Popup Widget -->
{% if contact_settings and contact_settings.is_active %}
<div class="contact-widget">
  <div class="contact-popup" id="contactPopup">
    <div class="contact-item">
      <a href="{{ contact_settings.zalo_link }}" target="_blank" class="contact-btn zalo-btn">
        <i class="fab fa-zalo"></i>
        <span>Zalo</span>
      </a>
    </div>
    <div class="contact-item">
      <a href="{{ contact_settings.messenger_link }}" target="_blank" class="contact-btn messenger-btn">
        <i class="fab fa-facebook-messenger"></i>
        <span>Messenger</span>
      </a>
    </div>
    <div class="contact-item">
      <a href="tel:{{ contact_settings.phone_number }}" class="contact-btn phone-btn">
        <i class="fas fa-phone"></i>
        <span>Gọi ngay</span>
      </a>
    </div>
  </div>
  <button class="contact-toggle" id="contactToggle">
    <i class="fas fa-comments"></i>
  </button>
</div>
{% endif %}

<style>
/* Contact Widget Styles */
.contact-widget {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
}

.contact-popup {
  position: absolute;
  bottom: 70px;
  right: 0;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  padding: 10px;
  transform: translateY(20px);
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  min-width: 200px;
}

.contact-popup.show {
  transform: translateY(0);
  opacity: 1;
  visibility: visible;
}

.contact-item {
  margin-bottom: 10px;
}

.contact-item:last-child {
  margin-bottom: 0;
}

.contact-btn {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  text-decoration: none;
  border-radius: 10px;
  transition: all 0.3s ease;
  color: white;
  font-weight: 600;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
}

.contact-btn i {
  margin-right: 10px;
  font-size: 18px;
}

.contact-btn:hover {
  transform: translateX(-5px);
  text-decoration: none;
  color: white;
}

.zalo-btn {
  background: linear-gradient(135deg, #0068ff, #0084ff);
}

.zalo-btn:hover {
  background: linear-gradient(135deg, #0056cc, #0066cc);
  box-shadow: 0 5px 15px rgba(0, 104, 255, 0.4);
}

.messenger-btn {
  background: linear-gradient(135deg, #006aff, #0084ff);
}

.messenger-btn:hover {
  background: linear-gradient(135deg, #0056cc, #0066cc);
  box-shadow: 0 5px 15px rgba(0, 106, 255, 0.4);
}

.phone-btn {
  background: linear-gradient(135deg, #25d366, #128c7e);
}

.phone-btn:hover {
  background: linear-gradient(135deg, #1ea952, #0f7a6b);
  box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
}

.contact-toggle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, #dc2626, #b91c1c);
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}

.contact-toggle:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(220, 38, 38, 0.6);
}

.contact-toggle:active {
  transform: scale(0.95);
}

/* Animation for toggle button */
.contact-toggle.rotate {
  transform: rotate(45deg);
}

/* Responsive */
@media (max-width: 768px) {
  .contact-widget {
    bottom: 15px;
    right: 15px;
  }
  
  .contact-popup {
    bottom: 60px;
    right: -10px;
    min-width: 180px;
  }
  
  .contact-toggle {
    width: 50px;
    height: 50px;
    font-size: 20px;
  }
}
</style>

<script>
// Contact Widget JavaScript
document.addEventListener('DOMContentLoaded', function() {
  const contactToggle = document.getElementById('contactToggle');
  const contactPopup = document.getElementById('contactPopup');
  let isOpen = false;

  contactToggle.addEventListener('click', function() {
    isOpen = !isOpen;
    
    if (isOpen) {
      contactPopup.classList.add('show');
      contactToggle.classList.add('rotate');
    } else {
      contactPopup.classList.remove('show');
      contactToggle.classList.remove('rotate');
    }
  });

  // Close popup when clicking outside
  document.addEventListener('click', function(event) {
    if (isOpen && !event.target.closest('.contact-widget')) {
      isOpen = false;
      contactPopup.classList.remove('show');
      contactToggle.classList.remove('rotate');
    }
  });
});
</script>

{% endblock %}
