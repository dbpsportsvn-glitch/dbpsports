{% extends "admin/change_form.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadModeRadios = document.querySelectorAll('input[name="upload_mode"]');
    const singleFileField = document.querySelector('#id_music_file').closest('.form-row');
    const bulkFileField = document.querySelector('#id_bulk_files').closest('.form-row');
    const titleField = document.querySelector('#id_title').closest('.form-row');
    const artistField = document.querySelector('#id_artist').closest('.form-row');
    
    function toggleFields() {
        const selectedMode = document.querySelector('input[name="upload_mode"]:checked').value;
        
        if (selectedMode === 'single') {
            singleFileField.style.display = 'block';
            bulkFileField.style.display = 'none';
            titleField.style.display = 'block';
            artistField.style.display = 'block';
            
            // Set required fields
            document.querySelector('#id_music_file').required = true;
            document.querySelector('#id_bulk_files').required = false;
        } else {
            singleFileField.style.display = 'none';
            bulkFileField.style.display = 'block';
            titleField.style.display = 'none';
            artistField.style.display = 'none';
            
            // Set required fields
            document.querySelector('#id_music_file').required = false;
            document.querySelector('#id_bulk_files').required = true;
        }
    }
    
    // Initial toggle
    toggleFields();
    
    // Add event listeners
    uploadModeRadios.forEach(radio => {
        radio.addEventListener('change', toggleFields);
    });
    
    // Add multiple attribute to bulk files input
    const bulkFileInput = document.querySelector('#id_bulk_files');
    if (bulkFileInput) {
        bulkFileInput.setAttribute('multiple', 'multiple');
        
        // Show file count when files are selected
        bulkFileInput.addEventListener('change', function() {
            const files = this.files;
            const helpText = this.nextElementSibling;
            if (files.length > 0) {
                helpText.textContent = `Đã chọn ${files.length} file(s): ${Array.from(files).map(f => f.name).join(', ')}`;
                helpText.style.color = '#28a745';
                helpText.style.fontWeight = 'bold';
            } else {
                helpText.textContent = 'Chọn nhiều file nhạc cùng lúc (chỉ hiển thị khi chọn \'Upload hàng loạt\')';
                helpText.style.color = '#6c757d';
                helpText.style.fontWeight = 'normal';
            }
        });
    }
});
</script>

<style>
.form-row {
    margin-bottom: 15px;
}

.form-row label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
}

.help {
    font-size: 0.9em;
    color: #6c757d;
    margin-top: 5px;
}

input[type="radio"] {
    margin-right: 8px;
}

.radio-group {
    margin-bottom: 15px;
}

.radio-group label {
    font-weight: normal;
    display: inline;
    margin-left: 5px;
}
</style>
{% endblock %}