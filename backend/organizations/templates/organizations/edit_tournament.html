{% extends 'organizations/organization_base.html' %}
{% load crispy_forms_tags %}

{% block title %}Chỉnh sửa: {{ tournament.name }}{% endblock %}

{% block sidebar %}
    {# Sửa lỗi nhỏ: Thêm context để menu được highlight chính xác #}
    {% include 'organizations/_manage_tournament_nav.html' with active_page='settings' %}
{% endblock %}

{% block management_content %}
<div class="card">
    {# --- BẮT ĐẦU KHỐI CODE ĐÃ SỬA --- #}
    <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
        <h3 class="mb-0"><i class="bi bi-pencil-square"></i> Chỉnh sửa thông tin giải đấu</h3>
        
        {# Nút "Lưu" được đưa lên đây và liên kết với form bằng id #}
        <button type="submit" form="edit-tournament-form" class="btn btn-primary">
            <i class="bi bi-save-fill"></i> Lưu thay đổi
        </button>
    </div>
    {# --- KẾT THÚC KHỐI CODE ĐÃ SỬA --- #}

    <div class="card-body p-4">
        <form method="post" enctype="multipart/form-data" id="edit-tournament-form">
            {% csrf_token %}
            
            <div class="row g-4">
                {# Cột trái: Thông tin cơ bản giải đấu #}
                <div class="col-lg-6">
                    <h5 class="mb-3 text-primary"><i class="bi bi-info-circle-fill"></i> Thông tin cơ bản</h5>
                    
                    {{ form.name|as_crispy_field }}
                    {{ form.status|as_crispy_field }}
                    {{ form.format|as_crispy_field }}
                    {{ form.region|as_crispy_field }}
                    {{ form.location_detail|as_crispy_field }}
                    
                    <div class="row">
                        <div class="col-md-6">
                            {{ form.start_date|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ form.end_date|as_crispy_field }}
                        </div>
                    </div>
                    
                    {{ form.image|as_crispy_field }}
                    {{ form.rules|as_crispy_field }}
                </div>
                
                {# Cột phải: Thông tin thanh toán #}
                <div class="col-lg-6">
                    <h5 class="mb-3 text-success"><i class="bi bi-cash-coin"></i> Thông tin thanh toán</h5>
                    
                    {{ form.registration_fee|as_crispy_field }}
                    {{ form.bank_name|as_crispy_field }}
                    {{ form.bank_account_number|as_crispy_field }}
                    {{ form.bank_account_name|as_crispy_field }}
                    {{ form.payment_qr_code|as_crispy_field }}
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-lightbulb-fill"></i> <strong>Mẹo:</strong>
                        <p class="mb-0 mt-2">Cung cấp đầy đủ thông tin thanh toán để các đội có thể dễ dàng đăng ký và chuyển khoản phí tham gia giải đấu.</p>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}