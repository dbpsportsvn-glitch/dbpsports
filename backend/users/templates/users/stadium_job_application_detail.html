{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Chi tiết Đơn Ứng Tuyển - {{ application.job.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'stadium_dashboard' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url 'stadium_job_applications' %}">Đơn Ứng Tuyển</a></li>
            <li class="breadcrumb-item active">Chi tiết</li>
        </ol>
    </nav>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="bi bi-file-text"></i> Chi tiết Đơn Ứng Tuyển</h2>
            <p class="text-muted mb-0">{{ stadium.stadium_name }}</p>
        </div>
        <div>
            <a href="{% url 'stadium_job_applications' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Quay lại
            </a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Thông tin Job -->
        <div class="col-lg-4">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-briefcase"></i> Thông tin Công việc</h5>
                </div>
                <div class="card-body">
                    <h5>{{ application.job.title }}</h5>
                    <p class="text-muted">{{ application.job.description|truncatewords:30 }}</p>
                    
                    <div class="mb-3">
                        <span class="badge bg-info fs-6">
                            <i class="bi {{ application.job.role_required.icon }}"></i> 
                            {{ application.job.role_required.name }}
                        </span>
                    </div>
                    
                    {% if application.job.budget %}
                    <div class="mb-3">
                        <strong><i class="bi bi-cash-coin"></i> Mức lương:</strong>
                        <span class="text-success fw-bold">{{ application.job.budget }}</span>
                    </div>
                    {% endif %}
                    
                    {% if application.job.location_detail %}
                    <div class="mb-3">
                        <strong><i class="bi bi-geo-alt"></i> Địa điểm:</strong>
                        <p class="mb-0">{{ application.job.location_detail }}</p>
                    </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <strong><i class="bi bi-calendar"></i> Đăng ngày:</strong>
                        <p class="mb-0">{{ application.job.created_at|date:"d/m/Y H:i" }}</p>
                    </div>
                    
                    <a href="{% url 'job_detail' application.job.pk %}" class="btn btn-outline-primary w-100">
                        <i class="bi bi-eye"></i> Xem tin tuyển dụng
                    </a>
                </div>
            </div>
        </div>

        <!-- Thông tin Ứng viên -->
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person"></i> Thông tin Ứng viên</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            {% if application.applicant.profile.avatar %}
                                <img src="{{ application.applicant.profile.avatar.url }}" 
                                     class="rounded-circle mb-3" 
                                     width="120" height="120" 
                                     alt="Avatar">
                            {% else %}
                                <div class="rounded-circle mb-3 bg-secondary d-flex align-items-center justify-content-center mx-auto" 
                                     style="width: 120px; height: 120px;">
                                    <i class="bi bi-person text-white fs-1"></i>
                                </div>
                            {% endif %}
                            
                            <h5>{{ application.applicant.get_full_name|default:application.applicant.username }}</h5>
                            <p class="text-muted">{{ application.applicant.email }}</p>
                            
                            <div class="mb-3">
                                {% if application.status == 'PENDING' %}
                                    <span class="badge bg-warning fs-6">Đang chờ</span>
                                {% elif application.status == 'APPROVED' %}
                                    <span class="badge bg-success fs-6">Đã chấp nhận</span>
                                {% elif application.status == 'REJECTED' %}
                                    <span class="badge bg-danger fs-6">Đã từ chối</span>
                                {% endif %}
                            </div>
                            
                            <a href="{% url 'public_profile' application.applicant.username %}" 
                               class="btn btn-outline-primary">
                                <i class="bi bi-person-circle"></i> Xem hồ sơ
                            </a>
                        </div>
                        
                        <div class="col-md-8">
                            <div class="row g-3">
                                <div class="col-12">
                                    <h6><i class="bi bi-calendar"></i> Thời gian ứng tuyển</h6>
                                    <p class="mb-3">{{ application.applied_at|date:"d/m/Y H:i" }}</p>
                                </div>
                                
                                {% if application.message %}
                                <div class="col-12">
                                    <h6><i class="bi bi-chat-text"></i> Lời nhắn từ ứng viên</h6>
                                    <div class="border rounded p-3 bg-light">
                                        <p class="mb-0">{{ application.message|linebreaks }}</p>
                                    </div>
                                </div>
                                {% endif %}
                                
                                {% if application.experience %}
                                <div class="col-12">
                                    <h6><i class="bi bi-award"></i> Kinh nghiệm</h6>
                                    <p class="mb-0">{{ application.experience|linebreaks }}</p>
                                </div>
                                {% endif %}
                                
                                {% if application.skills %}
                                <div class="col-12">
                                    <h6><i class="bi bi-tools"></i> Kỹ năng</h6>
                                    <p class="mb-0">{{ application.skills|linebreaks }}</p>
                                </div>
                                {% endif %}
                                
                                {% if application.portfolio_url %}
                                <div class="col-12">
                                    <h6><i class="bi bi-link-45deg"></i> Portfolio</h6>
                                    <a href="{{ application.portfolio_url }}" target="_blank" class="btn btn-outline-info btn-sm">
                                        <i class="bi bi-box-arrow-up-right"></i> Xem Portfolio
                                    </a>
                                </div>
                                {% endif %}
                                
                                {% if application.expected_salary %}
                                <div class="col-12">
                                    <h6><i class="bi bi-cash-coin"></i> Mức lương mong muốn</h6>
                                    <p class="mb-0 text-success fw-bold">{{ application.expected_salary }}</p>
                                </div>
                                {% endif %}
                                
                                {% if application.availability %}
                                <div class="col-12">
                                    <h6><i class="bi bi-clock"></i> Thời gian có thể làm việc</h6>
                                    <p class="mb-0">{{ application.availability|linebreaks }}</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            {% if application.status == 'PENDING' %}
            <div class="card shadow mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-gear"></i> Xử lý Đơn Ứng Tuyển</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <form method="post" class="d-grid">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="accept">
                                <button type="submit" class="btn btn-success btn-lg"
                                        onclick="return confirm('Chấp nhận đơn ứng tuyển của {{ application.applicant.get_full_name|default:application.applicant.username }}?')">
                                    <i class="bi bi-check-circle"></i> Chấp nhận Ứng tuyển
                                </button>
                            </form>
                            <small class="text-muted d-block mt-2">
                                Ứng viên sẽ nhận được thông báo và có thể bắt đầu làm việc.
                            </small>
                        </div>
                        <div class="col-md-6">
                            <form method="post" class="d-grid">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="reject">
                                <button type="submit" class="btn btn-danger btn-lg"
                                        onclick="return confirm('Từ chối đơn ứng tuyển của {{ application.applicant.get_full_name|default:application.applicant.username }}?')">
                                    <i class="bi bi-x-circle"></i> Từ chối Ứng tuyển
                                </button>
                            </form>
                            <small class="text-muted d-block mt-2">
                                Ứng viên sẽ nhận được thông báo về việc từ chối.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
