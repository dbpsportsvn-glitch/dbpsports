{% load custom_filters %}

<style>
/* ============================================
   MODERN STANDINGS STYLES - REDESIGNED
   ============================================ */

.standings-container {
    padding: 1rem 0;
}

.standings-section {
    margin-bottom: 2rem;
}

.standings-groups-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 2rem;
}

/* Section Header */
.standings-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border-radius: 16px;
    border: 1px solid rgba(102, 126, 234, 0.2);
}

.standings-header-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.standings-header-content h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2d3748;
    margin: 0 0 0.25rem 0;
}

.standings-header-content p {
    color: #718096;
    margin: 0;
    font-size: 0.95rem;
}

/* Standings Card */
.standings-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
}

/* Table Styles */
.standings-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.standings-table thead {
    background: #f8fafc;
}

.standings-table thead th {
    padding: 1rem 0.75rem;
    font-weight: 600;
    color: #4a5568;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e2e8f0;
    text-align: center;
}

.standings-table tbody tr {
    border-bottom: 1px solid #f1f5f9;
    transition: background-color 0.2s ease;
}

.standings-table tbody tr:hover {
    background-color: #f8fafc;
}

.standings-table tbody tr.qualified {
    background: linear-gradient(90deg, rgba(16, 185, 129, 0.12), transparent);
    border-left: 4px solid #10b981;
}

.standings-table tbody td {
    padding: 1rem 0.75rem;
    vertical-align: middle;
    text-align: center;
}

.standings-table tbody td:nth-child(2) {
    text-align: left;
    padding: 1rem 0.75rem;
}

.standings-table thead th {
    padding: 1rem 0.75rem;
    font-weight: 600;
    color: #4a5568;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e2e8f0;
    text-align: center;
    background: rgba(102, 126, 234, 0.1);
}

.standings-table thead th:nth-child(2) {
    text-align: center;
    color: #667eea;
    font-weight: 700;
}

/* Rank Column */
.rank-cell {
    width: 50px;
}

.rank-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-weight: 700;
    font-size: 0.9rem;
    background: #e2e8f0;
    color: #4a5568;
}

.rank-badge.rank-1 {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #333;
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
}

.rank-badge.rank-2 {
    background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
    color: #333;
    box-shadow: 0 2px 8px rgba(192, 192, 192, 0.3);
}

.rank-badge.rank-3 {
    background: linear-gradient(135deg, #cd7f32, #e8a866);
    color: #fff;
    box-shadow: 0 2px 8px rgba(205, 127, 50, 0.3);
}

/* Team Column */
.team-cell {
    min-width: 200px;
    max-width: 300px;
    width: auto;
}

.team-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    color: #1e293b;
    transition: color 0.2s ease;
    font-weight: 600;
    padding-left: 0;
}

.team-info:hover {
    color: #667eea;
}

.team-logo {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    object-fit: contain;
    background: #f8fafc;
    flex-shrink: 0;
}

.team-name {
    font-weight: 700;
    font-size: 1rem;
    white-space: normal;
    word-wrap: break-word;
    line-height: 1.3;
    color: #1e293b;
    display: block;
}

/* Stats Columns */
.stats-cell {
    width: 60px;
}

.stat-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    padding: 0 0.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.85rem;
    background: #f1f5f9;
    color: #475569;
}

.stat-win {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
}

.stat-draw {
    background: rgba(251, 191, 36, 0.1);
    color: #d97706;
}

.stat-loss {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
}

.stat-gd {
    font-weight: 700;
}

.stat-gd.positive {
    background: rgba(16, 185, 129, 0.15);
    color: #059669;
}

.stat-gd.negative {
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
}

/* Points Column */
.points-cell {
    width: 70px;
}

.points-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    font-weight: 800;
    font-size: 1.1rem;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

/* Legend */
.standings-legend {
    padding: 1rem 1.5rem;
    background: #f8fafc;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 1.5rem;
    align-items: center;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: #64748b;
}

.legend-indicator {
    width: 20px;
    height: 3px;
    border-radius: 2px;
    background: #10b981;
}

/* Empty State */
.empty-standings {
    text-align: center;
    padding: 3rem 1rem;
    color: #64748b;
}

.empty-standings i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

/* Responsive */
@media (max-width: 768px) {
    .standings-groups-grid {
        grid-template-columns: 1fr;
    }
    
    .standings-header {
        flex-direction: column;
        text-align: center;
    }
    
    .standings-table thead th,
    .standings-table tbody td {
        padding: 0.75rem 0.5rem;
    }
    
    .team-cell {
        min-width: 150px;
        max-width: 200px;
    }
    
    .team-name {
        font-size: 0.9rem;
        font-weight: 700;
    }
    
    .stats-cell {
        width: 50px;
    }
    
    .points-cell {
        width: 60px;
    }
    
    .team-name {
        font-size: 0.85rem;
    }
    
    .stat-number {
        min-width: 24px;
        height: 24px;
        font-size: 0.8rem;
    }
    
    .points-badge {
        min-width: 35px;
        height: 35px;
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .standings-table {
        font-size: 0.8rem;
    }
    
    .standings-table thead th,
    .standings-table tbody td {
        padding: 0.5rem 0.25rem;
    }
    
    .team-cell {
        min-width: 120px;
        max-width: 160px;
    }
    
    .team-name {
        font-size: 0.85rem;
        font-weight: 700;
    }
    
    .stats-cell {
        width: 40px;
    }
    
    .points-cell {
        width: 50px;
    }
}
</style>

<div class="standings-container">
    {% if tournament.format == 'LEAGUE' %}
        {# === LEAGUE FORMAT === #}
        <div class="standings-section">
            <div class="standings-header">
                <div class="standings-header-icon">
                    <i class="bi bi-trophy-fill"></i>
                </div>
                <div class="standings-header-content">
                    <h3>Bảng xếp hạng</h3>
                    <p>Thứ hạng và thành tích các đội</p>
                </div>
            </div>

            <div class="standings-card">
                <table class="standings-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Đội bóng</th>
                            <th title="Đã đấu">ĐĐ</th>
                            <th title="Thắng">T</th>
                            <th title="Hòa">H</th>
                            <th title="Bại">B</th>
                            <th title="Hiệu số">HS</th>
                            <th title="Điểm">Điểm</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in standings_data|get_item:'LEAGUE' %}
                        <tr class="{% if forloop.counter <= 2 %}qualified{% endif %}">
                            <td class="rank-cell">
                                <div class="rank-badge {% if forloop.counter == 1 %}rank-1{% elif forloop.counter == 2 %}rank-2{% elif forloop.counter == 3 %}rank-3{% endif %}">
                                    {{ forloop.counter }}
                                </div>
                            </td>
                            <td class="team-cell">
                                <a href="{% url 'team_detail' pk=row.team_obj.pk %}" class="team-info">
                                    {% if row.team_obj.logo %}
                                    <img src="{{ row.team_obj.logo.url }}" alt="{{ row.team_obj.name }}" class="team-logo">
                                    {% endif %}
                                    <span class="team-name">{{ row.team_obj.name }}</span>
                                </a>
                            </td>
                            <td class="stats-cell">
                                <span class="stat-number">{{ row.played }}</span>
                            </td>
                            <td class="stats-cell">
                                <span class="stat-number stat-win">{{ row.wins }}</span>
                            </td>
                            <td class="stats-cell">
                                <span class="stat-number stat-draw">{{ row.draws }}</span>
                            </td>
                            <td class="stats-cell">
                                <span class="stat-number stat-loss">{{ row.losses }}</span>
                            </td>
                            <td class="stats-cell">
                                <span class="stat-number stat-gd {% if row.gd > 0 %}positive{% elif row.gd < 0 %}negative{% endif %}">
                                    {% if row.gd > 0 %}+{% endif %}{{ row.gd }}
                                </span>
                            </td>
                            <td class="points-cell">
                                <div class="points-badge">{{ row.points }}</div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <div class="standings-legend">
                    <div class="legend-item">
                        <div class="legend-indicator"></div>
                        <span>Vòng loại trực tiếp</span>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        {# === GROUP FORMAT === #}
        <div class="standings-groups-grid">
            {% for group in tournament.groups.all %}
            <div class="standings-section">
                <div class="standings-header">
                    <div class="standings-header-icon">
                        <i class="bi bi-grid-3x3-gap-fill"></i>
                    </div>
                    <div class="standings-header-content">
                        <h3>{{ group.name }}</h3>
                        <p>Bảng xếp hạng</p>
                    </div>
                </div>

                <div class="standings-card">
                    <table class="standings-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Đội</th>
                                <th title="Đã đấu">ĐĐ</th>
                                <th title="Thắng">T</th>
                                <th title="Hòa">H</th>
                                <th title="Bại">B</th>
                                <th title="Hiệu số">HS</th>
                                <th title="Điểm">Đ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in standings_data|get_item:group.id %}
                            <tr class="{% if forloop.counter <= 2 %}qualified{% endif %}">
                                <td class="rank-cell">
                                    <div class="rank-badge {% if forloop.counter == 1 %}rank-1{% elif forloop.counter == 2 %}rank-2{% elif forloop.counter == 3 %}rank-3{% endif %}">
                                        {{ forloop.counter }}
                                    </div>
                                </td>
                                <td class="team-cell">
                                    <a href="{% url 'team_detail' pk=row.team_obj.pk %}" class="team-info">
                                        {% if row.team_obj.logo %}
                                        <img src="{{ row.team_obj.logo.url }}" alt="{{ row.team_obj.name }}" class="team-logo">
                                        {% endif %}
                                        <span class="team-name">{{ row.team_obj.name }}</span>
                                    </a>
                                </td>
                                <td class="stats-cell">
                                    <span class="stat-number">{{ row.played }}</span>
                                </td>
                                <td class="stats-cell">
                                    <span class="stat-number stat-win">{{ row.wins }}</span>
                                </td>
                                <td class="stats-cell">
                                    <span class="stat-number stat-draw">{{ row.draws }}</span>
                                </td>
                                <td class="stats-cell">
                                    <span class="stat-number stat-loss">{{ row.losses }}</span>
                                </td>
                                <td class="stats-cell">
                                    <span class="stat-number stat-gd {% if row.gd > 0 %}positive{% elif row.gd < 0 %}negative{% endif %}">
                                        {% if row.gd > 0 %}+{% endif %}{{ row.gd }}
                                    </span>
                                </td>
                                <td class="points-cell">
                                    <div class="points-badge">{{ row.points }}</div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    <div class="standings-legend">
                        <div class="legend-item">
                            <div class="legend-indicator"></div>
                            <span>Vòng loại trực tiếp</span>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="empty-standings">
                <i class="bi bi-inbox"></i>
                <p>Chưa có bảng đấu nào được tạo</p>
            </div>
            {% endfor %}
        </div>
    {% endif %}
</div>