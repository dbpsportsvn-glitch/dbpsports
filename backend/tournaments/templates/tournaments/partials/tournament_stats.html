{% comment %} File: backend/tournaments/templates/tournaments/partials/tournament_stats.html {% endcomment %}

{# --- DÀNH CHO CÁC THỐNG KÊ TỔNG QUAN --- #}
<div class="row row-cols-2 row-cols-md-4 g-4 mb-4">
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">TỔNG SỐ ĐỘI</h6>
                <p class="display-5 fw-bold mb-0">{{ total_teams }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">TỔNG SỐ CẦU THỦ</h6>
                <p class="display-5 fw-bold mb-0">{{ total_players }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">SỐ TRẬN ĐÃ ĐẤU</h6>
                <p class="display-5 fw-bold mb-0">{{ finished_matches_count }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">TỔNG BÀN THẮNG</h6>
                <p class="display-5 fw-bold mb-0">{{ total_normal_goals }}</p>
            </div>
        </div>
    </div>
</div>

{# --- DÀNH CHO CÁC THỐNG KÊ CHI TIẾT HƠN --- #}
<div class="row row-cols-2 row-cols-md-3 row-cols-lg-5 g-4">
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">BÀN THẮNG / TRẬN</h6>
                <p class="display-5 fw-bold mb-0">{{ avg_goals_per_match }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">BÀN PHẢN LƯỚI</h6>
                <p class="display-5 fw-bold mb-0">{{ total_own_goals }}</p>
            </div>
        </div>
    </div>

    {# === Ô HAT-TRICK ĐÃ ĐƯỢC CHUYỂN LÊN ĐÂY === #}
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">SỐ LƯỢT HAT-TRICK</h6>
                <p class="display-5 fw-bold mb-0">{{ hattricks }}</p>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">TỔNG SỐ THẺ VÀNG</h6>
                <p class="display-5 fw-bold mb-0 text-warning">{{ total_yellow_cards }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-center h-100 shadow-sm">
            <div class="card-body">
                <h6 class="card-title text-muted">TỔNG SỐ THẺ ĐỎ</h6>
                <p class="display-5 fw-bold mb-0 text-danger">{{ total_red_cards }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-header"><h5 class="section-title mb-0">Vua phá lưới</h5></div>
            <ul class="list-group list-group-flush">
                {% for player in top_scorers %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>
                            {% if player.team.logo %}<img src="{{ player.team.logo.url }}" width="20" height="20" class="me-2" style="object-fit: contain;">{% endif %}
                            <a href="{% url 'player_detail' pk=player.pk %}">{{ player.full_name }}</a> ({{ player.team.name }})
                        </span>
                        <span class="badge bg-primary rounded-pill">{{ player.goal_count }} bàn</span>
                    </li>
                {% empty %}
                    <li class="list-group-item">Chưa có bàn thắng nào được ghi.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header"><h5 class="section-title mb-0">Thống kê Bàn thắng/Thua</h5></div>
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead><tr><th>#</th><th>Đội</th><th class="text-center">BT</th><th class="text-center">BB</th><th class="text-center">HS</th></tr></thead>
                    <tbody>
                        {% for row in team_goal_stats %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td><a href="{% url 'team_detail' pk=row.team_obj.pk %}">{{ row.team_obj.name }}</a></td>
                            <td class="text-center">{{ row.gf }}</td>
                            <td class="text-center">{{ row.ga }}</td>
                            <td class="text-center"><strong>{{ row.gd }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header"><h5 class="section-title mb-0">Thống kê Thẻ phạt</h5></div>
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead><tr><th>#</th><th>Đội</th><th class="text-center">Thẻ vàng</th><th class="text-center">Thẻ đỏ</th></tr></thead>
                    <tbody>
                        {% for row in team_card_stats %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td><a href="{% url 'team_detail' pk=row.team_obj.pk %}">{{ row.team_obj.name }}</a></td>
                            <td class="text-center">{{ row.yellow_cards }}</td>
                            <td class="text-center">{{ row.red_cards }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>