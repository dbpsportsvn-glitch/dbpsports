{% comment %} File: backend/tournaments/templates/tournaments/partials/knockout_bracket.html - Modern Redesign {% endcomment %}

<div class="modern-bracket-wrapper">
  
  {# DEBUG: Ki·ªÉm tra d·ªØ li·ªáu knockout #}
  {% comment %}
  <div style="background: rgba(255,255,255,0.1); padding: 1rem; margin-bottom: 1rem; border-radius: 8px; color: white;">
    <strong>üîç DEBUG INFO:</strong><br>
    Quarter Finals: {{ knockout_data.quarter_final_1|yesno:"Yes,No" }} | {{ knockout_data.quarter_final_2|yesno:"Yes,No" }} | {{ knockout_data.quarter_final_3|yesno:"Yes,No" }} | {{ knockout_data.quarter_final_4|yesno:"Yes,No" }}<br>
    Semi Finals: {{ knockout_data.semi_final_1|yesno:"Yes,No" }} | {{ knockout_data.semi_final_2|yesno:"Yes,No" }}<br>
    Final: {{ knockout_data.final_match|yesno:"Yes,No" }}<br>
    Third Place: {{ knockout_data.third_place_match|yesno:"Yes,No" }}
  </div>
  {% endcomment %}
  
  <div class="bracket-container">
    <div class="bracket">

      {# ===== Quarter-finals (QF) ===== #}
      {% if knockout_data.quarter_final_1 or knockout_data.quarter_final_2 or knockout_data.quarter_final_3 or knockout_data.quarter_final_4 %}
      <div class="bracket-round quarter-finals">
        <div class="round-header">
          <i class="bi bi-trophy"></i>
          <span>T·ª© k·∫øt</span>
        </div>
        
        <div class="bracket-match" data-match-type="quarter">
          <div class="match-header">
            <span class="match-label">QF1</span>
            {% if knockout_data.quarter_final_1 and knockout_data.quarter_final_1.match_time %}
            <span class="match-time">{{ knockout_data.quarter_final_1.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.quarter_final_1 %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>

        <div class="bracket-match" data-match-type="quarter">
          <div class="match-header">
            <span class="match-label">QF2</span>
            {% if knockout_data.quarter_final_2 and knockout_data.quarter_final_2.match_time %}
            <span class="match-time">{{ knockout_data.quarter_final_2.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.quarter_final_2 %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>

        <div class="bracket-match" data-match-type="quarter">
          <div class="match-header">
            <span class="match-label">QF3</span>
            {% if knockout_data.quarter_final_3 and knockout_data.quarter_final_3.match_time %}
            <span class="match-time">{{ knockout_data.quarter_final_3.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.quarter_final_3 %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>

        <div class="bracket-match" data-match-type="quarter">
          <div class="match-header">
            <span class="match-label">QF4</span>
            {% if knockout_data.quarter_final_4 and knockout_data.quarter_final_4.match_time %}
            <span class="match-time">{{ knockout_data.quarter_final_4.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.quarter_final_4 %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>
      </div>
      {% endif %}

      {# ===== Semi-finals (SF) ===== #}
      {% if knockout_data.semi_final_1 or knockout_data.semi_final_2 %}
      <div class="bracket-round semi-finals">
        <div class="round-header">
          <i class="bi bi-star-fill"></i>
          <span>B√°n k·∫øt</span>
        </div>
        
        <div class="bracket-match" data-match-type="semi">
          <div class="match-header">
            <span class="match-label">SF1</span>
            {% if knockout_data.semi_final_1 and knockout_data.semi_final_1.match_time %}
            <span class="match-time">{{ knockout_data.semi_final_1.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.semi_final_1 %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>

        <div class="bracket-match" data-match-type="semi">
          <div class="match-header">
            <span class="match-label">SF2</span>
            {% if knockout_data.semi_final_2 and knockout_data.semi_final_2.match_time %}
            <span class="match-time">{{ knockout_data.semi_final_2.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.semi_final_2 %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>
      </div>
      {% endif %}

      {# ===== Final (own column) ===== #}
      {% if knockout_data.final_match %}
      <div class="bracket-round final-round">
        <div class="round-header final-header">
          <i class="bi bi-trophy-fill"></i>
          <span>Chung k·∫øt</span>
        </div>
        
        <div class="bracket-match final" data-match-type="final">
          <div class="match-header final-match-header">
            <span class="match-label">FINAL</span>
            {% if knockout_data.final_match and knockout_data.final_match.match_time %}
            <span class="match-time">{{ knockout_data.final_match.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.final_match %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
          {% if knockout_data.final_match and knockout_data.final_match.winner %}
          <div class="champion-badge">
            <i class="bi bi-trophy-fill"></i> V√î ƒê·ªäCH
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}

      {# ===== Third place (own column; no connectors) ===== #}
      {% if knockout_data.third_place_match %}
      <div class="bracket-round third-place-round">
        <div class="round-header third-place-header">
          <i class="bi bi-award"></i>
          <span>H·∫°ng Ba</span>
        </div>
        
        <div class="bracket-match third-place" data-match-type="third">
          <div class="match-header">
            <span class="match-label">3RD</span>
            {% if knockout_data.third_place_match.match_time %}
            <span class="match-time">{{ knockout_data.third_place_match.match_time|date:"d/m H:i" }}</span>
            {% endif %}
          </div>
          {% with match=knockout_data.third_place_match %}
            {% include "tournaments/partials/_bracket_match_content.html" with match=match placeholder="Ch·ªù x√°c ƒë·ªãnh..." %}
          {% endwith %}
        </div>
      </div>
      {% endif %}

    </div>
  </div>
</div>
