{% extends 'base.html' %}
{% load humanize %}

{% block title %}Lịch sử Chuyển nhượng{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="pb-3 mb-4 border-bottom d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
            <h1><i class="bi bi-clock-history text-primary"></i> Lịch sử Chuyển nhượng</h1>
            <p class="lead mb-0">Tổng hợp các thương vụ đã hoàn tất trên hệ thống.</p>
        </div>
        <a href="{% url 'transfer_market' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại Thị trường
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th scope="col">Cầu thủ</th>
                        <th scope="col">Từ đội</th>
                        <th scope="col">Đến đội</th>
                        <th scope="col" class="text-end">Phí</th>
                        <th scope="col" class="text-center">Loại hình</th>
                        <th scope="col" class="text-center">Ngày hoàn tất</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transfer in transfers %}
                    <tr>
                        <td>
                            <a href="{% url 'player_detail' pk=transfer.player.pk %}" class="d-flex align-items-center gap-2 text-decoration-none text-dark fw-bold">
                                {% if transfer.player.avatar %}
                                    <img src="{{ transfer.player.avatar.url }}" alt="{{ transfer.player.full_name }}" style="width: 32px; height: 32px; object-fit: cover; border-radius: 50%;">
                                {% endif %}
                                <span>{{ transfer.player.full_name }}</span>
                            </a>
                        </td>
                        <td>
                            {# === BẮT ĐẦU CẬP NHẬT LIÊN KẾT ĐỘI BÓNG === #}
                            <a href="{% url 'public_team_detail' pk=transfer.current_team.pk %}" class="d-flex align-items-center gap-2 text-decoration-none text-dark">
                                {% if transfer.current_team.logo %}
                                    <img src="{{ transfer.current_team.logo.url }}" alt="{{ transfer.current_team.name }}" style="width: 24px; height: 24px; object-fit: contain;">
                                {% endif %}
                                <span>{{ transfer.current_team.name }}</span>
                            </a>
                            {# === KẾT THÚC CẬP NHẬT === #}
                        </td>
                        <td>
                            {# === BẮT ĐẦU CẬP NHẬT LIÊN KẾT ĐỘI BÓNG === #}
                            <a href="{% url 'public_team_detail' pk=transfer.inviting_team.pk %}" class="d-flex align-items-center gap-2 text-decoration-none text-dark">
                                {% if transfer.inviting_team.logo %}
                                    <img src="{{ transfer.inviting_team.logo.url }}" alt="{{ transfer.inviting_team.name }}" style="width: 24px; height: 24px; object-fit: contain;">
                                {% endif %}
                                <span>{{ transfer.inviting_team.name }}</span>
                            </a>
                            {# === KẾT THÚC CẬP NHẬT === #}
                        </td>
                        <td class="text-end text-success fw-bold">{{ transfer.offer_amount|intcomma }} VNĐ</td>
                        <td class="text-center">
                            {% if transfer.transfer_type == 'LOAN' %}
                                <span class="badge bg-info text-dark">Cho mượn</span>
                            {% else %}
                                <span class="badge bg-primary">Mua đứt</span>
                            {% endif %}
                        </td>
                        <td class="text-center text-muted small">{{ transfer.updated_at|date:"d/m/Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center p-4 text-muted">Chưa có thương vụ nào được hoàn tất.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}