{% extends "base.html" %}
{% block title %}Giải đấu · DBP Sports{% endblock %}
{% block content %}
<style>
  .tour-card .card-img-top {
    height: 180px;
    object-fit: cover;
  }
  /* === BẮT ĐẦU CSS MỚI === */
  /* Thêm một viền vàng phát sáng cho card của admin */
  .admin-tournament-card {
    border: 2px solid #FFC107;
    box-shadow: 0 0 15px rgba(255, 193, 7, 0.5) !important;
  }
  /* === KẾT THÚC CSS MỚI === */
</style>

<div class="pb-3 mb-4 border-bottom d-flex justify-content-between align-items-center">
  <h1 class="h3 m-0">Giải đấu</h1>
</div>

{# Khu vực bộ lọc giữ nguyên #}
<div class="card card-body mb-4">
  <form method="get" class="row g-3 align-items-center">
    <div class="col-md-5">
      <label for="regionFilter" class="form-label">Lọc theo Khu vực</label>
      <select name="region" id="regionFilter" class="form-select">
        <option value="">Tất cả khu vực</option>
        {% for region_value, region_name in all_regions %}
          <option value="{{ region_value }}" {% if region_value == current_region %}selected{% endif %}>{{ region_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-5">
      <label for="orgFilter" class="form-label">Lọc theo Đơn vị Tổ chức</label>
      <select name="org" id="orgFilter" class="form-select">
        <option value="">Tất cả đơn vị</option>
        {% for org in all_organizations %}
          <option value="{{ org.id }}" {% if org.id|stringformat:"s" == current_org %}selected{% endif %}>{{ org.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2 mt-auto">
      <button type="submit" class="btn btn-primary w-100">Tìm kiếm</button>
    </div>
  </form>
</div>

{% if tournaments %}
  <div class="row row-cols-1 row-cols-md-3 g-3">
    {% for t in tournaments %}
      <div class="col">
        {# === THAY ĐỔI: Thêm class đặc biệt nếu là giải của admin === #}
        <div class="card h-100 shadow-sm tour-card d-flex flex-column {% if not t.organization %}admin-tournament-card{% endif %}">
          {% if t.image %}
            <img class="card-img-top" src="{{ t.image.url }}" alt="{{ t.name }}">
          {% endif %}

          {# === THÊM class flex-grow-1 VÀO DÒNG DƯỚI ĐÂY === #}
          <div class="card-body flex-grow-1">
            <h5 class="card-title mb-2 text-start">{{ t.name }}</h5>

            <p class="mb-2 text-muted">
              <span class="badge bg-info text-dark me-2">{{ t.get_region_display }}</span>
              
              {# === BẮT ĐẦU THAY ĐỔI TẠI ĐÂY === #}
              <span class="d-inline-flex align-items-center gap-2">
                {% if t.organization and t.organization.logo %}
                  <img src="{{ t.organization.logo.url }}" alt="{{ t.organization.name }}" style="width: 20px; height: 20px; object-fit: contain; border-radius: 4px;">
                {% endif %}
                
                <span class="small badge bg-secondary px-2 py-1">
                  BTC: 
                  {# Thêm điều kiện để đổi màu chữ #}
                  <span {% if not t.organization %}class="text-warning fw-bold"{% endif %}>
                    {% if t.organization %}{{ t.organization.name }}{% else %}DBP Sports{% endif %}
                  </span>
                </span>

              </span>
              {# === KẾT THÚC THAY ĐỔI === #}

            </p>

            <p class="mb-2 text-muted">
              {{ t.start_date|date:"d/m/Y" }} – {{ t.end_date|date:"d/m/Y" }}
              <span class="badge bg-success ms-2">{{ t.get_status_display }}</span>
            </p>
          </div>

          <div class="card-footer bg-white border-0 pt-0 mt-auto">
            <div class="d-flex gap-2">
              <a class="btn btn-primary btn-sm" href="{% url 'tournament_detail' pk=t.pk %}">Xem chi tiết</a>
              {% if t.status == "REGISTRATION_OPEN" %}
                <a class="btn btn-outline-success btn-sm" href="{% url 'create_team' tournament_pk=t.pk %}">Đăng ký</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">Không tìm thấy giải đấu nào phù hợp với tiêu chí của bạn.</p>
{% endif %}
{% endblock %}