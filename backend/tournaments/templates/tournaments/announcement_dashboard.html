{% extends 'base.html' %}

{% block title %}Bảng tin Giải đấu{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
        position: relative;
        z-index: 1;
    }
    
    /* Ensure navbar is always on top */
    .site-header {
        z-index: 1030 !important;
    }
    
    
    .dashboard-stats {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        backdrop-filter: blur(10px);
    }
    
    .stat-item {
        text-align: center;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        display: block;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    .announcement-card {
        transition: transform 0.2s ease-in-out;
    }
    
    .announcement-card:hover {
        transform: translateY(-2px);
    }
    
    .tournament-badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #6c757d;
    }
    
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .announcement-card.deleted {
        opacity: 0;
        transform: scale(0.8);
        transition: all 0.3s ease-in-out;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex align-items-center mb-3">
                    <div class="me-3 bg-light rounded d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                        <i class="bi bi-megaphone-fill text-primary" style="font-size: 2rem;"></i>
                    </div>
                    <div>
                        <h1 class="display-5 fw-bold mb-2">Bảng tin Giải đấu</h1>
                        <p class="lead mb-0">Thông báo từ Ban tổ chức các giải bạn tham gia</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="dashboard-stats">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="stat-item">
                                <span class="stat-number" id="total-announcements">{{ announcements|length }}</span>
                                <span class="stat-label">Thông báo</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat-item">
                                <span class="stat-number" id="read-announcements">{{ announcements|length }}</span>
                                <span class="stat-label">Đã đọc</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat-item">
                                <span class="stat-number" id="current-announcements">{{ announcements|length }}</span>
                                <span class="stat-label">Hiện tại</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    {% if announcements %}
        <div class="row">
            {% for announcement in announcements %}
                <div class="col-lg-8 mx-auto mb-4">
                    <div class="card shadow-sm announcement-card position-relative">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0">
                                    <i class="bi bi-bullhorn me-2"></i>{{ announcement.title }}
                                </h5>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="tournament-badge bg-light text-primary">
                                    {{ announcement.tournament.name }}
                                </span>
                                <button type="button" class="btn-close btn-close-white" onclick="hideAnnouncement(this)" title="Ẩn thông báo này"></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-calendar-event text-muted me-2"></i>
                                    <small class="text-muted">{{ announcement.created_at|date:"H:i, d/m/Y" }}</small>
                                </div>
                                {% if announcement.audience == 'CAPTAINS_ONLY' %}
                                    <span class="badge bg-warning text-dark">
                                        <i class="bi bi-shield-check me-1"></i>Chỉ đội trưởng
                                    </span>
                                {% else %}
                                    <span class="badge bg-success">
                                        <i class="bi bi-people me-1"></i>Công khai
                                    </span>
                                {% endif %}
                            </div>
                            <div class="card-text">
                                {{ announcement.content|linebreaks }}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="empty-state">
                            <i class="bi bi-megaphone"></i>
                            <h4>Chưa có thông báo!</h4>
                            <p class="mb-4">Hiện tại chưa có thông báo nào từ Ban tổ chức.</p>
                            <a href="{% url 'tournaments_active' %}" class="btn btn-primary">
                                <i class="bi bi-trophy me-2"></i>Xem các giải đấu
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<script>
function hideAnnouncement(button) {
    // Tìm card chứa button này
    const card = button.closest('.announcement-card');
    
    // Thêm class deleted để animate
    card.classList.add('deleted');
    
    // Cập nhật số liệu sau animation
    setTimeout(() => {
        updateAnnouncementStats();
        
        // Xóa card khỏi DOM
        card.remove();
    }, 300);
}

function updateAnnouncementStats() {
    const totalAnnouncements = document.querySelectorAll('.announcement-card:not(.deleted)').length;
    
    // Cập nhật tất cả số liệu
    document.getElementById('total-announcements').textContent = totalAnnouncements;
    document.getElementById('read-announcements').textContent = totalAnnouncements;
    document.getElementById('current-announcements').textContent = totalAnnouncements;
    
    // Nếu không còn thông báo nào, hiển thị empty state mà không reload
    if (totalAnnouncements === 0) {
        // Tìm container chứa announcements (container chính)
        const mainContainer = document.querySelector('.container');
        if (mainContainer) {
            // Tìm phần announcements list để thay thế
            const announcementsSection = mainContainer.querySelector('.row:last-child');
            if (announcementsSection) {
                announcementsSection.innerHTML = `
                    <div class="col-lg-8 mx-auto">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <div class="empty-state">
                                    <i class="bi bi-megaphone"></i>
                                    <h4>Chưa có thông báo!</h4>
                                    <p class="mb-4">Hiện tại chưa có thông báo nào từ Ban tổ chức.</p>
                                    <a href="/tournaments/active/" class="btn btn-primary">
                                        <i class="bi bi-trophy me-2"></i>Xem các giải đấu
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
    }
}

// Cập nhật số liệu khi trang load
document.addEventListener('DOMContentLoaded', function() {
    updateAnnouncementStats();
});
</script>
{% endblock %}