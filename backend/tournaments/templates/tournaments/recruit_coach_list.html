{% extends 'base.html' %}
{% load static %}

{% block title %}Chi√™u m·ªô Hu·∫•n luy·ªán vi√™n - {{ team.name }}{% endblock %}

{% block extra_css %}
<style>
/* ========================================
   MODERN FILTER SECTION
   ======================================== */
.filter-section {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border-radius: 20px;
  padding: 2rem;
  margin-bottom: 2.5rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(59, 130, 246, 0.1);
}

.filter-section h3 {
  color: #1e293b;
  font-weight: 700;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.filter-section h3::before {
  content: '';
  width: 4px;
  height: 24px;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border-radius: 2px;
}

.form-label {
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.5rem;
}

.form-select, .form-control {
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  padding: 0.75rem 1rem;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  background: white;
}

.form-select:focus, .form-control:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  outline: none;
}

.filter-btn {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border: none;
  border-radius: 12px;
  padding: 0.75rem 2rem;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.filter-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

/* ========================================
   PAGE HEADER
   ======================================== */
.page-header {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 3px solid #f1f5f9;
  position: relative;
}

.page-header::after {
  content: '';
  position: absolute;
  bottom: -3px;
  left: 0;
  width: 60px;
  height: 3px;
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  border-radius: 2px;
}

.page-title {
  font-size: 2.5rem;
  font-weight: 800;
  color: #1e293b;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.page-title::before {
  content: 'üë®‚Äçüíº';
  font-size: 2rem;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.page-subtitle {
  color: #64748b;
  font-size: 1.1rem;
  margin-top: 0.5rem;
}

/* ========================================
   COACH CARDS
   ======================================== */
.coach-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.coach-card {
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  border: 2px solid transparent;
}

.coach-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
  border-color: #8b5cf6;
}

.coach-header {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  padding: 1.5rem;
  color: white;
  position: relative;
}

.coach-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 4px solid rgba(255, 255, 255, 0.3);
  object-fit: cover;
  margin-bottom: 1rem;
}

.coach-avatar-placeholder {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 4px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  margin-bottom: 1rem;
}

.coach-name {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: 0.25rem;
}

.coach-location {
  opacity: 0.9;
  font-size: 0.9rem;
}

.coach-body {
  padding: 1.5rem;
}

.coach-info {
  margin-bottom: 1rem;
}

.coach-info-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.coach-info-item i {
  width: 16px;
  color: #6366f1;
}

.coach-bio {
  color: #64748b;
  font-size: 0.9rem;
  line-height: 1.5;
  margin-bottom: 1.5rem;
}

.coach-actions {
  display: flex;
  gap: 0.75rem;
}

.btn-coach {
  flex: 1;
  border-radius: 12px;
  font-weight: 600;
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
}

.btn-coach-primary {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border: none;
  color: white;
}

.btn-coach-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
  color: white;
}

.btn-coach-success {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border: none;
  color: white;
}

.btn-coach-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
  color: white;
}

.btn-coach-secondary {
  background: #f3f4f6;
  border: 2px solid #e5e7eb;
  color: #6b7280;
}

.btn-coach-secondary:hover {
  background: #e5e7eb;
  color: #374151;
}

/* ========================================
   EMPTY STATE
   ======================================== */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border-radius: 20px;
  margin-top: 2rem;
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: 1.5rem;
  opacity: 0.6;
}

.empty-state h5 {
  color: #1e293b;
  font-weight: 700;
  margin-bottom: 1rem;
}

.empty-state p {
  color: #64748b;
  margin-bottom: 0;
}

/* ========================================
   RESPONSIVE
   ======================================== */
@media (max-width: 768px) {
  .page-title {
    font-size: 2rem;
  }
  
  .coach-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .filter-section {
    padding: 1.5rem;
  }
  
  .coach-actions {
    flex-direction: column;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Page Header -->
    <div class="page-header">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'team_detail' team.pk %}">{{ team.name }}</a></li>
                <li class="breadcrumb-item active">Chi√™u m·ªô HLV</li>
            </ol>
        </nav>
        
        <h1 class="page-title">T√¨m Hu·∫•n luy·ªán vi√™n</h1>
        <p class="page-subtitle">T√¨m ki·∫øm v√† g·ª≠i l·ªùi m·ªùi cho HLV ph√π h·ª£p v·ªõi ƒë·ªôi b√≥ng {{ team.name }}</p>
    </div>
    
    <!-- Filter Section -->
    <div class="filter-section">
        <h3><i class="bi bi-funnel"></i> B·ªô l·ªçc t√¨m ki·∫øm</h3>
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label"><i class="bi bi-geo-alt"></i> Khu v·ª±c</label>
                <select name="region" class="form-select">
                    <option value="">T·∫•t c·∫£</option>
                    {% for value, label in region_choices %}
                    <option value="{{ value }}" {% if current_region == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="col-md-3">
                <label class="form-label"><i class="bi bi-graph-up"></i> Kinh nghi·ªám</label>
                <select name="experience" class="form-select">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="5+" {% if current_exp == '5+' %}selected{% endif %}>T·ª´ 5 nƒÉm</option>
                    <option value="10+" {% if current_exp == '10+' %}selected{% endif %}>T·ª´ 10 nƒÉm</option>
                </select>
            </div>
            
            <div class="col-md-4">
                <label class="form-label"><i class="bi bi-search"></i> T√¨m ki·∫øm</label>
                <input type="text" name="q" class="form-control" placeholder="T√™n, ch·ª©ng ch·ªâ, chuy√™n m√¥n..." value="{{ search_query }}">
            </div>
            
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn filter-btn w-100">
                    <i class="bi bi-funnel"></i> L·ªçc
                </button>
            </div>
        </form>
    </div>
    
    <!-- Coach Grid -->
    {% if coaches %}
        <div class="coach-grid">
            {% for coach in coaches %}
            <div class="coach-card">
                <div class="coach-header">
                    {% if coach.avatar %}
                    <img src="{{ coach.avatar.url }}" class="coach-avatar" alt="{{ coach.full_name }}">
                    {% else %}
                    <div class="coach-avatar-placeholder">
                        <i class="bi bi-person-badge"></i>
                    </div>
                    {% endif %}
                    
                    <div class="coach-name">{{ coach.full_name }}</div>
                    <div class="coach-location">
                        {{ coach.get_region_display }}
                        {% if coach.location_detail %} - {{ coach.location_detail }}{% endif %}
                    </div>
                </div>
                
                <div class="coach-body">
                    <div class="coach-info">
                        {% if coach.coaching_license %}
                        <div class="coach-info-item">
                            <i class="bi bi-award"></i>
                            <strong>{{ coach.coaching_license }}</strong>
                        </div>
                        {% endif %}
                        
                        {% if coach.years_of_experience %}
                        <div class="coach-info-item">
                            <i class="bi bi-calendar-check"></i>
                            {{ coach.years_of_experience }} nƒÉm kinh nghi·ªám
                        </div>
                        {% endif %}
                        
                        {% if coach.specialization %}
                        <div class="coach-info-item">
                            <i class="bi bi-star"></i>
                            {{ coach.specialization }}
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if coach.bio %}
                    <div class="coach-bio">
                        {{ coach.bio|truncatewords:20 }}
                    </div>
                    {% endif %}
                    
                    <div class="coach-actions">
                        <a href="{% url 'coach_profile_detail' coach.pk %}" class="btn btn-coach btn-coach-primary" target="_blank">
                            <i class="bi bi-eye"></i> Xem h·ªì s∆°
                        </a>
                        
                        {% if coach.id in sent_offers %}
                        <button class="btn btn-coach btn-coach-secondary" disabled>
                            <i class="bi bi-check-circle"></i> ƒê√£ g·ª≠i
                        </button>
                        {% else %}
                        <button class="btn btn-coach btn-coach-success" onclick="sendOffer({{ coach.pk }}, '{{ coach.full_name|escapejs }}')">
                            <i class="bi bi-envelope"></i> G·ª≠i l·ªùi m·ªùi
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üë®‚Äçüíº</div>
            <h5>Kh√¥ng t√¨m th·∫•y HLV ph√π h·ª£p</h5>
            <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c quay l·∫°i sau.</p>
        </div>
    {% endif %}
    
    <!-- Back Button -->
    <div class="text-center mt-5">
        <a href="{% url 'team_detail' team.pk %}" class="btn filter-btn">
            <i class="bi bi-arrow-left"></i> Quay l·∫°i ƒë·ªôi
        </a>
    </div>
</div>

{# Modal g·ª≠i l·ªùi m·ªùi #}
<div class="modal fade" id="offerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-envelope"></i> G·ª≠i l·ªùi m·ªùi chi√™u m·ªô
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    B·∫°n ƒëang g·ª≠i l·ªùi m·ªùi cho HLV <strong id="coachNameDisplay"></strong>
                </div>
                
                <form id="offerForm">
                    {% csrf_token %}
                    <input type="hidden" id="coachId" name="coach_id">
                    
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-cash-coin"></i> M·ª©c l∆∞∆°ng ƒë·ªÅ ngh·ªã (VNƒê)
                        </label>
                        <input type="number" name="salary_offer" class="form-control" 
                               placeholder="V√≠ d·ª•: 5000000" min="0">
                        <div class="form-text">ƒê·ªÉ tr·ªëng n·∫øu mu·ªën th·ªèa thu·∫≠n sau</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-calendar-range"></i> Th·ªùi h·∫°n h·ª£p ƒë·ªìng
                        </label>
                        <input type="text" name="contract_duration" class="form-control" 
                               placeholder="V√≠ d·ª•: 1 nƒÉm, 6 th√°ng, theo gi·∫£i ƒë·∫•u...">
                        <div class="form-text">M√¥ t·∫£ th·ªùi gian h·ª£p t√°c</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="bi bi-chat-left-text"></i> L·ªùi nh·∫Øn *
                        </label>
                        <textarea name="message" class="form-control" rows="5" required
                                  placeholder="Gi·ªõi thi·ªáu v·ªÅ ƒë·ªôi b√≥ng, k·∫ø ho·∫°ch ph√°t tri·ªÉn, l√Ω do mu·ªën m·ªùi HLV n√†y..."></textarea>
                        <div class="form-text">L·ªùi nh·∫Øn c√†ng ch√¢n th√†nh c√†ng thu h√∫t HLV</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> H·ªßy
                </button>
                <button type="button" class="btn btn-success" onclick="submitOffer()">
                    <i class="bi bi-send"></i> G·ª≠i l·ªùi m·ªùi
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let currentCoachId = null;
let offerModal = null;

document.addEventListener('DOMContentLoaded', function() {
    offerModal = new bootstrap.Modal(document.getElementById('offerModal'));
});

function sendOffer(coachId, coachName) {
    currentCoachId = coachId;
    document.getElementById('coachId').value = coachId;
    document.getElementById('coachNameDisplay').textContent = coachName;
    
    // Reset form
    document.getElementById('offerForm').reset();
    document.getElementById('coachId').value = coachId; // Set l·∫°i sau khi reset
    
    offerModal.show();
}

function submitOffer() {
    const formData = new FormData(document.getElementById('offerForm'));
    
    // Validate
    const message = formData.get('message');
    if (!message || message.trim() === '') {
        alert('Vui l√≤ng nh·∫≠p l·ªùi nh·∫Øn!');
        return;
    }
    
    fetch(`/team/{{ team.pk }}/coach/${currentCoachId}/send-offer/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            offerModal.hide();
            alert('ƒê√£ g·ª≠i l·ªùi m·ªùi th√†nh c√¥ng! HLV s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o.');
            location.reload();
        } else {
            alert(data.error || 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');
    });
}
</script>
{% endblock %}

