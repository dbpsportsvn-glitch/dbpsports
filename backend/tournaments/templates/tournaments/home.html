{% extends 'base.html' %}
{% load static %}

{% comment %} File: backend/tournaments/templates/tournaments/home.html {% endcomment %}

{% block hero %}
<section class="carousel" id="heroCarousel">
  <div class="carousel-track">
    {% for b in banners %}
      <div class="carousel-slide">
        <img src="{{ b.image.url }}" alt="{{ b.title }}">
        <div class="carousel-caption">
          <h2>{{ b.title }}</h2>
          {% if b.subtitle %}<p>{{ b.subtitle }}</p>{% endif %}
          {% if b.button_text and b.button_url %}
            <div class="carousel-actions">
              <a href="{{ b.button_url }}" class="btn btn-warning">{{ b.button_text }}</a>
            </div>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <div class="carousel-slide">
        <img src="{% static 'images/hero-1.jpg' %}" alt="Sân vận động">
        <div class="carousel-caption">
          <h2>Sân chơi bóng đá đỉnh cao</h2>
          <p>Tổ chức, tham gia và theo dõi giải đấu dễ dàng.</p>
          <div class="carousel-actions">
            <a href="{% url 'livestream' %}" class="btn btn-warning">Xem Livestream</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="carousel-dots"></div>
  <div class="carousel-nav">
      <button class="carousel-prev" aria-label="Previous slide"><i class="bi bi-chevron-left"></i></button>
      <button class="carousel-next" aria-label="Next slide"><i class="bi bi-chevron-right"></i></button>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const root = document.getElementById('heroCarousel');
  if (!root) return;

  const track = root.querySelector('.carousel-track');
  const slides = Array.from(root.querySelectorAll('.carousel-slide'));
  const dotsContainer = root.querySelector('.carousel-dots');
  const nextBtn = root.querySelector('.carousel-next');
  const prevBtn = root.querySelector('.carousel-prev');
  let currentIndex = 0;
  let autoPlayInterval = null;

  if (slides.length <= 1) {
    if(dotsContainer) dotsContainer.style.display = 'none';
    if(nextBtn) nextBtn.style.display = 'none';
    if(prevBtn) prevBtn.style.display = 'none';
    return;
  }
  
  function updateCarousel() {
    track.style.transform = `translateX(-${currentIndex * 100}%)`;
    const dots = dotsContainer.querySelectorAll('button');
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentIndex);
    });
  }

  function goToSlide(index) {
    currentIndex = (index + slides.length) % slides.length;
    updateCarousel();
    resetAutoPlay();
  }
  
  function createDots() {
      slides.forEach((_, index) => {
          const button = document.createElement('button');
          button.addEventListener('click', () => goToSlide(index));
          dotsContainer.appendChild(button);
      });
  }

  function startAutoPlay() {
    autoPlayInterval = setInterval(() => {
      goToSlide(currentIndex + 1);
    }, 5000); // Chuyển slide sau mỗi 5 giây
  }

  function resetAutoPlay() {
    clearInterval(autoPlayInterval);
    startAutoPlay();
  }

  prevBtn.addEventListener('click', () => goToSlide(currentIndex - 1));
  nextBtn.addEventListener('click', () => goToSlide(currentIndex + 1));
  
  createDots();
  updateCarousel();
  startAutoPlay();
});
</script>
{% endblock %}

{% block content %}
  <div class="section-title-wrapper">
      <div class="section-title-container">
        <h2 class="section-title">Các giải đấu nổi bật</h2>
      </div>
  </div>
  
  <div class="row">
    {% for tournament in tournaments_list %}

      <div class="col-lg-6 mb-4">
        {# 1. Thêm class để có viền vàng nếu là giải của Super Admin #}
        <div class="card shadow-sm h-100 {% if not tournament.organization %}admin-tournament-card{% endif %}">
          <div class="tournament-card-bg" style="position: relative; color: white;">
            {% if tournament.image %}
              <img src="{{ tournament.image.url }}" class="card-img-bg" alt="{{ tournament.name }} banner">
              <div class="card-img-overlay"></div>
            {% endif %}
            <div class="card-body">
              <h5 class="card-title h4 fw-bold">{{ tournament.name }}</h5>
              <p class="card-text mb-2">
                <small>
                  Bắt đầu: {{ tournament.start_date|date:"d/m/Y" }} |
                  Kết thúc: {{ tournament.end_date|date:"d/m/Y" }}
                </small>
              </p>
              
              {# 2. Thêm thông tin BTC với logo và chữ màu vàng #}
              <div class="d-inline-flex align-items-center gap-2 mb-3">
                {% if tournament.organization and tournament.organization.logo %}
                  <img src="{{ tournament.organization.logo.url }}" alt="{{ tournament.organization.name }}" style="width: 20px; height: 20px; object-fit: contain; border-radius: 4px;">
                {% endif %}
                <span class="small badge bg-dark px-2 py-1" style="--bs-bg-opacity: .7;">
                  BTC: 
                  <span {% if not tournament.organization %}class="text-warning fw-bold"{% endif %}>
                    {% if tournament.organization %}{{ tournament.organization.name }}{% else %}DBP Sports{% endif %}
                  </span>
                </span>
              </div>

              <a href="{% url 'tournament_detail' pk=tournament.pk %}" class="btn btn-light btn-sm mt-auto d-block">Xem chi tiết</a>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-muted">{{ tournament.get_status_display }}</small>
          </div>
        </div>
      </div>
      {# === KẾT THÚC THAY THẾ TẠI ĐÂY === #}
    {% empty %}
      <div class="col"><p>Chưa có giải đấu nào nổi bật.</p></div>
    {% endfor %}
  </div>
{% endblock %}


{% block extra_css %}
<style>
  /* === CSS CHO TIÊU ĐỀ "CÁC GIẢI ĐẤU" === */
   .section-title-wrapper {
    text-align: left;
    margin-bottom: 1.5rem;
  }
  .section-title-container {
    display: inline-block;
    background: linear-gradient(90deg, #0f172a, #1e293b);
    padding: 0.75rem 1.5rem;
    border-radius: .75rem;
    box-shadow: 0 4px 12px rgba(0,0,0,.1);
  }
  .section-title-container .section-title {
    color: #FFC107;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
  }

  /* === BẮT ĐẦU SỬA KÍCH THƯỚC BANNER === */
  /* 1. CHỈNH CHIỀU CAO BANNER TẠI ĐÂY */
  .carousel-slide {
      height: 450px; /* <-- Tăng từ 380px lên 420px (bạn có thể đổi thành số khác) */
  }

  .carousel-caption {
    position: absolute;
    left: 50%;
    top: 50%; 
    transform: translate(-50%, -50%); 
    color: #fff;
    width: 90%;
    text-align: center;
    z-index: 2;
  }
  /* 2. CHỈNH KÍCH THƯỚC CHỮ TẠI ĐÂY */
  .carousel-caption h2 {
    font-size: 48px;  /* <-- Tăng từ 32px lên 48px (bạn có thể đổi thành số khác) */
    font-weight: 800;
    text-shadow: 0 4px 15px rgba(0,0,0,0.9);
    margin-bottom: 0.5rem;
  }
  .carousel-caption p {
    font-size: 1.3rem; /* <-- Tăng chữ nhỏ cho tương xứng */
    text-shadow: 0 2px 8px rgba(0,0,0,0.8);
    margin-bottom: 1rem; 
  }

  /* === THÊM DÒNG CHỈNH KÍCH THƯỚC CHỮ NÚT BẤM TẠI ĐÂY === */
  .carousel-actions .btn {
      font-size: 1rem; /* <-- Bạn có thể thay đổi số này, ví dụ: 0.9rem, 1.1rem */
      padding: 0.5rem 1.5rem; /* Tăng khoảng đệm cho nút to hơn một chút */
  }

  /* CSS CHO DI ĐỘNG */
  @media (max-width: 767px) {
    .carousel-slide {
      height: 40vh; /* Giữ nguyên chiều cao trên di động */
    }
    .carousel-caption h2 {
      font-size: 1.8rem !important; /* Giữ nguyên chữ trên điện thoại */
    }
    .carousel-caption p {
      display: none;
    }
    .section-title-container .section-title {
        font-size: 1.25rem;
    }
  }
  /* === KẾT THÚC SỬA KÍCH THƯỚC BANNER === */

  .admin-tournament-card {
    border: 2px solid #FFC107;
    box-shadow: 0 0 15px rgba(255, 193, 7, 0.5) !important;
  }
  
</style>
{% endblock %}