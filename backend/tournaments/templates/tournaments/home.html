{% extends 'base.html' %}
{% load static %}

{% block hero %}
<section class="carousel" id="heroCarousel" style="position: relative; overflow: hidden;">
  <div class="carousel-track" style="display: flex; transition: transform .6s ease;">
    {% for b in banners %}
      <div class="carousel-slide" style="min-width: 100%; position: relative; height: 85vh; min-height: 450px;">
        <img src="{{ b.image.url }}" alt="" onerror="this.style.display='none'" style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;">
        <div class="carousel-caption">
          <h2>{{ b.title }}</h2>
          {% if b.subtitle %}<p>{{ b.subtitle }}</p>{% endif %}
          {% if b.button_text and b.button_url %}
            <div class="carousel-actions"><a href="{{ b.button_url }}">{{ b.button_text }}</a></div>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <div class="carousel-slide" style="min-width: 100%; position: relative; height: 85vh; min-height: 450px;">
        <img src="{% static 'images/hero-1.jpg' %}" alt="" style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;">
        <div class="carousel-caption">
          <h2>Sân chơi bóng đá đỉnh cao</h2>
          <p>Tổ chức, tham gia và theo dõi giải đấu dễ dàng.</p>
          <div class="carousel-actions"><a href="{% url 'livestream' %}">Xem livestream</a></div>
        </div>
      </div>
    {% endfor %}
  </div>
</section>

<script>
(function(){
  const root = document.getElementById('heroCarousel');
  if(!root) return;
  const track = root.querySelector('.carousel-track');
  const slides = Array.from(root.querySelectorAll('.carousel-slide'));
  let i = 0, timer = null;
  function render(){ track.style.transform = `translateX(-${i*100}%)`; }
  function tick(){ timer = setInterval(()=>{ i = (i+1)%slides.length; render(); }, 4500); }
  if(slides.length){ render(); tick(); }
})();
</script>
{% endblock %}


{% block content %}
  <div class="section-title-wrapper">
      <div class="section-title-container">
        <h2 class="section-title">Các giải đấu nổi bật</h2>
      </div>
  </div>
  
  <div class="row">
    {% for tournament in tournaments_list %}
    
      <div class="col-lg-6 mb-4">
        {# 1. Thêm class để có viền vàng nếu là giải của Super Admin #}
        <div class="card shadow-sm h-100 {% if not tournament.organization %}admin-tournament-card{% endif %}">
          <div class="tournament-card-bg" style="position: relative; color: white;">
            {% if tournament.image %}
              <img src="{{ tournament.image.url }}" class="card-img-bg" alt="{{ tournament.name }} banner">
              <div class="card-img-overlay"></div>
            {% endif %}
            <div class="card-body">
              <h5 class="card-title h4 fw-bold">{{ tournament.name }}</h5>
              <p class="card-text mb-2">
                <small>
                  Bắt đầu: {{ tournament.start_date|date:"d/m/Y" }} |
                  Kết thúc: {{ tournament.end_date|date:"d/m/Y" }}
                </small>
              </p>
              
              {# 2. Thêm thông tin BTC với logo và chữ màu vàng #}
              <div class="d-inline-flex align-items-center gap-2 mb-3">
                {% if tournament.organization and tournament.organization.logo %}
                  <img src="{{ tournament.organization.logo.url }}" alt="{{ tournament.organization.name }}" style="width: 20px; height: 20px; object-fit: contain; border-radius: 4px;">
                {% endif %}
                <span class="small badge bg-dark px-2 py-1" style="--bs-bg-opacity: .7;">
                  BTC: 
                  <span {% if not tournament.organization %}class="text-warning fw-bold"{% endif %}>
                    {% if tournament.organization %}{{ tournament.organization.name }}{% else %}DBP Sports{% endif %}
                  </span>
                </span>
              </div>

              <a href="{% url 'tournament_detail' pk=tournament.pk %}" class="btn btn-light btn-sm mt-auto d-block">Xem chi tiết</a>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-muted">{{ tournament.get_status_display }}</small>
          </div>
        </div>
      </div>
      {# === KẾT THÚC THAY THẾ TẠI ĐÂY === #}
    {% empty %}
      <div class="col"><p>Chưa có giải đấu nào nổi bật.</p></div>
    {% endfor %}
  </div>
{% endblock %}


{% block extra_css %}
<style>
  /* === CSS CHO TIÊU ĐỀ "CÁC GIẢI ĐẤU" === */
   .section-title-wrapper {
    text-align: left; /* Căn lề trái */
    margin-bottom: 1.5rem;
  }
  .section-title-container {
    display: inline-block; /* Chỉ bao trọn chữ */
    background: linear-gradient(90deg, #0f172a, #1e293b);
    padding: 0.75rem 1.5rem;
    border-radius: .75rem;
    box-shadow: 0 4px 12px rgba(0,0,0,.1);
  }
  .section-title-container .section-title {
    color: #FFC107; /* Màu chữ vàng */
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
  }

  /* === CSS TINH CHỈNH BANNER === */
  .carousel-caption {
    position: absolute;
    left: 50%;
    top: 50%; 
    transform: translate(-50%, -50%); 
    color: #fff;
    width: 90%;
    text-align: center;
    z-index: 2;
  }
  .carousel-caption h2 {
    font-size: 56px; 
    font-weight: 800;
    text-shadow: 0 5px 20px rgba(0,0,0,0.9);
    margin-bottom: 0.75rem;
  }
  .carousel-caption p {
    font-size: 1.2rem;
    text-shadow: 0 2px 8px rgba(0,0,0,0.8);
    margin-bottom: 1.75rem; 
  }

  /* CSS CHO DI ĐỘNG */
  @media (max-width: 767px) {
    .carousel-slide {
      height: 60vh !important;
      min-height: 350px !important;
    }
    .carousel-caption h2 {
      font-size: 2.5rem !important;
      line-height: 1.2;
    }
    .carousel-caption p {
      font-size: 1rem !important;
      margin-bottom: 1.25rem;
    }
    .section-title-container .section-title {
        font-size: 1.25rem;
    }
  }
</style>
{% endblock %}